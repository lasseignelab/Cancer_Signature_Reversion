---
title: "220323_PLIER_LVs"
author: "Jennifer Fisher"
date: "3/23/2022"
output:
  html_document:
    toc: true
    theme: united
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# START 
    Goal/Purpose of operations: 
    quick summary 
    
    Finished psedocode on: 
    220323
    
    System which operations were done on: 
    my laptop
    
    GitHub Repo:
    Transfer_leanring_R03
    
    Docker:
    jenfisher7/rstudio_tf_dr_v3
    
    Directory of operations: 
    /home/rstudio/ "Docker"
    
    Scripts being edited for operations: 
    NA
    
    Data being used:
    For this analysis, the human protein-protein interaction (PPI) networks were downloaded from the STRING database (March 2022; version 11.5). This database contains known and predicted protein-protein interactions that include direct and indirect associations.
    Also the limma, deseq2, and transfere leanring results for GBM
    
    Papers and tools: 
    igrpah was used for PPI network analysis. 
    gPROFILER2 was used for pathway analysis.

# STEPS
### Set working directory 
### load in data
```{r}
recount3_plier <- readRDS("~/data/recount3/recount3_plier_wo.rds")
```
### Analysis
```{r}
Z_mtx<- recount3_plier$Z
```

```{r}
rm(recount3_plier_gbm)
gc()
```

test 3 genes

```{r}
hist(Z_mtx[1,])
hist(Z_mtx[100,])
hist(Z_mtx[1000,])
```
usually low for each these genes. 


histogram of median
```{r}
gene_med_weights <- rowMedians(Z_mtx)
```
```{r}
hist(gene_med_weights)
```

```{r}
gene_avg_weight <- rowMeans(Z_mtx)
```

```{r}
hist(gene_avg_weight)
```

```{r}
gene_max_weight <- rowMax(Z_mtx)
```

```{r}
hist(gene_max_weight)
```
```{r}
hist(Z_mtx)
```

```{r}
dim(Z_mtx)
```

```{r}
plot(gene_avg_weight, gene_max_weight)
```
```{r}
plot(gene_avg_weight, gene_med_weights)
```
there are genes that mostlyhave zero weights with an outlier 
interesting that are some genes where is seems like they are similar 

```{r}
gene_diff_test <- gene_avg_weight - gene_med_weights
```

```{r}
hist(gene_diff_test)
```
```{r}
table(gene_diff_test <0.02)
```

```{r}
plot(gene_max_weight, gene_diff_test)
```


```{r}
corr <- gene_diff_test <0.02
```

```{r}
max_plotting<- cbind(gene_avg_weight, corr)
```

```{r}
gene_std_weights <- rowSds(Z_mtx)
```

```{r}
hist(gene_std_weights)
```
```{r}
plot(gene_avg_weight, gene_std_weights)
```

```{r}
plot(gene_med_weights, gene_std_weights)
```

```{r}
gene_sp <- cor(t(Z_mtx), method= "spearman")
```

```{r}
gene_sp_Avg <- rowMeans(gene_sp)
```

```{r}
hist(gene_sp_Avg)
```
no correlation between weights and other genes


```{r}
ppi <- read.delim("~/data/9606.protein.links.v11.5.txt" , sep= " ", header = TRUE)
```

high confidence - 0.7

```{r}
ppi$combined_score<- ppi$combined_score /1000
```

```{r}
ppi$combined_score<- ifelse(ppi$protein1 == ppi$protein2, 1, ppi$combined_score)
```

```{r}
hist(ppi$combined_score)
```
```{r}
ppi_protein_info<- t(as.data.frame( strsplit(readLines("~/data/9606.protein.info.v11.5.txt"), "\t")))
ppi_protein_info <- as.data.frame(ppi_protein_info)
```

```{r}
ppi<- ppi[ppi$combined_score >0.7,]
```


```{r}
protein1_symbols <- c()
protein2_symbols<- c()
for (i in 1:length(ppi$protein1)){
  #print(i)
  protein1_symbols[i]<- ppi_protein_info$V2[ppi$protein1[i] == ppi_protein_info$V1]
  protein2_symbols[i]<-ppi_protein_info$V2[ppi$protein2[i] == ppi_protein_info$V1]
}
scores<- ppi$combined_score
symbol_ppi_table <- cbind(protein1_symbols, protein2_symbols, scores)
```

```{r}
saveRDS(symbol_ppi_table, "~/string_ppi_symbol.rds")
```


```{r}
symbol_ppi_table_df <- as.data.frame(symbol_ppi_table)
library(igraph)
g <- graph_from_data_frame(symbol_ppi_table_df , directed=FALSE)
```
calculate centrality metrics
```{r}
string_ppi_degree<- degree(g)
string_ppi_betweenness<- betweenness(g)
string_ppi_eign_cent <- eigen_centrality(g)
```

```{r}
string_ppi_eign_cent_vector <- string_ppi_eign_cent$vector
```

```{r}
string_ppi_details <-data.frame(degree= string_ppi_degree, betweenness= string_ppi_betweenness, eign_cent= string_ppi_eign_cent_vector)
```

```{r}
plot(string_ppi_details$degree, string_ppi_betweenness)
```
```{r}
plot(string_ppi_details$degree, string_ppi_details$eign_cent)
```

```{r}
plot(string_ppi_details$betweenness, string_ppi_details$eign_cent)
```
```{r eval=False}
saveRDS(string_ppi_details, "~/string_ppi_metrics.rds")
```

```{r}
#compare all the lvs GENE list 

#5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55, 60, 65, 70, 75, 80, 85, 90, 95, 100
top_genes_num <- seq(from=2 , to= 100, by=2)
fraction <- c()
for (i in 1:length(top_genes_num)){
  gene_list<- c()
  num<- top_genes_num[i]
  for (j in 1:ncol(Z_mtx)) {
    topgene<- rownames(Z_mtx)[order(-Z_mtx[,j])][1:num]
    gene_list <- c(gene_list, topgene)
  }
  top <- length(unique(gene_list))
  bottom<- num *ncol(Z_mtx)
  fraction[i]<- top/bottom
}
```

```{r}
plot(top_genes_num, fraction)
```



```{r}
lv_topgene_data<- data.frame(Number= top_genes_num, Unique_fraction =fraction)
```

```{r}
library(ggplot2)
ggplot(lv_topgene_data, aes(x= Number, y= Unique_fraction))+geom_point()+theme_classic()+ geom_line(aes(y=0.80))+ geom_line(aes(x=10))
```


```{r}
  gene_list<- c()
  num<- top_genes_num[i]
  for (j in 1:ncol(Z_mtx)) {
    topgene<- rownames(Z_mtx)[order(-Z_mtx[,j])][1:10]
    gene_list <- c(gene_list, topgene)
  }
```

```{r}
length(gene_list)
```


```{r}
library(dplyr)

string_ppi_details$top_10_weights <- rownames(string_ppi_details) %in% gene_list
```

```{r}
library(ggplot2)
```


```{r}
ggplot(string_ppi_details, aes(x=top_10_weights, y=degree, fill=top_10_weights )) + 
  geom_violin()+ geom_point() +labs(title="LV PPI Degree",x="Top 10 Weight?", y = "PPI Degree", color= "Top 10 Weight?") + scale_colour_manual(values =  c("#440154FF","#228C8DFF"), aesthetics = c("colour", "fill"))+ theme_minimal()
```

```{r}
string_ppi_details$degree_log<- log(string_ppi_details$degree)
```

```{r}
ggplot(string_ppi_details, aes(x=top_10_weights, y=degree_log, fill=top_10_weights )) + 
  geom_violin()+ geom_point() +labs(title="LV PPI Degree",x="Top 10 Weight?", y = "PPI log(Degree)", color= "Top 10 Weight?") + scale_colour_manual(values =  c("#440154FF","#228C8DFF"), aesthetics = c("colour", "fill"))+ theme_minimal()
```
```{r}
plot(string_ppi_details$degree, string_ppi_details$degree_log)
```


```{r}
ggplot(string_ppi_details, aes(x=top_10_weights, y=betweenness, fill=top_10_weights)) + 
  geom_violin()+ geom_point() +labs(title="LV PPI Betweeness",x="Top 10 Weight?", y = "PPI Betweeness", color= "Top 10 Weight?") + scale_colour_manual(values =  c("#440154FF","#228C8DFF"), aesthetics = c("colour", "fill"))+ theme_minimal()
```

```{r}
string_ppi_details$log_betweness <- log(string_ppi_details$betweenness)
ggplot(string_ppi_details, aes(x=top_10_weights, y=log_betweness , fill=top_10_weights)) + 
  geom_violin()+ geom_point() +labs(title="LV PPI Betweeness",x="Top 10 Weight?", y = "PPI log(Betweeness)", color= "Top 10 Weight?") + scale_colour_manual(values =  c("#440154FF","#228C8DFF"), aesthetics = c("colour", "fill"))+ theme_minimal()
```
```{r}
plot(string_ppi_details$betweenness, string_ppi_details$log_betweness)
```

```{r}
ggplot(string_ppi_details, aes(x=top_10_weights, y=eign_cent, fill=top_10_weights)) + 
  geom_violin()+ geom_point() +labs(title="LV PPI Eigenvector Centrality Scores",x="Top 10 Weight?", y = "PPI Eigenvector Centrality Scores", color= "Top 10 Weight?") + scale_colour_manual(values =  c("#440154FF","#228C8DFF"), aesthetics = c("colour", "fill"))+ theme_minimal()
```

```{r}
string_ppi_details$eign_cent_log <- log(string_ppi_details$eign_cent)
ggplot(string_ppi_details, aes(x=top_10_weights, y=eign_cent_log, fill=top_10_weights)) + 
  geom_violin()+ geom_point() +labs(title="LV PPI Eigenvector Centrality Scores",x="Top 10 Weight?", y = "PPI log(Eigenvector Centrality Scores)", color= "Top 10 Weight?") + scale_colour_manual(values =  c("#440154FF","#228C8DFF"), aesthetics = c("colour", "fill"))+ theme_minimal()
```
```{r}
plot(string_ppi_details$eign_cent, string_ppi_details$eign_cent_log)
```


```{r}
#
string_ppi_details_true <- string_ppi_details[string_ppi_details$top_10_weights == TRUE,]
string_ppi_details_false <- string_ppi_details[string_ppi_details$top_10_weights == FALSE,]

```

```{r}
test1 <- wilcox.test(string_ppi_details_true$degree, string_ppi_details_false$degree)
```

```{r}
p.adjust(test1$p.value, method= "bonferroni", n= 3)
```


```{r}
test2<- wilcox.test(string_ppi_details_true$betweenness, string_ppi_details_false$betweenness)
```

```{r}
p.adjust(test2$p.value, method= "bonferroni", n= 3)
```


```{r}
test3<- wilcox.test(string_ppi_details_true$eign_cent, string_ppi_details_false$eign_cent)
```

```{r}
p.adjust(test3$p.value, method= "bonferroni", n= 3)
```

```{r}
dim(string_ppi_details)
```


### Save Data
### Save Figures
    
# END
    Location of final scripts:
    scripts
    
    Location of data produced:
    output
    
    Dates when operations were done:
    220323-220426
    
## Versions
```{r}
sessionInfo()
```

