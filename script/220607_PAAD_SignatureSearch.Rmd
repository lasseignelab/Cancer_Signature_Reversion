---
title: "220607_PAAD_SignatureSearch"
author: "Jennifer Fisher"
date: "6/7/2022"
output:
  html_document:
    toc: true
    theme: united
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# START 
    Goal/Purpose of operations: 
     Conduct Signature Reversion on PAAD samples with both the DESeq2, limma, and the transfer learning approaches
    
    Finished psedocode on:
    220607
    
    System which operations were done on: 
    my laptop
    
    GitHub Repo:
    Transfer_Learning_R03
    
    Docker/Singularity: 
    rstudio_cancer_dr
    
    Directory of operations: 
    "/home/rstudio"
    
    Scripts being edited for operations:
    One SignatureSearch function needed adjust for new LINCS datbase, and Tau values needed to added
    
    Data being used: 
    PAAD gene expression alaysis output and the latent variable output
    
    Papers and tools:
    SignatureSearch. LINCS method for signature reversion 
    
# STEPS
### Set working directory 
### load in data
```{r}
library(recount3)
library(SummarizedExperiment)
source("/home/rstudio/script/functions_cancer_signature_reversion_JLF.R")
library(signatureSearch)
library(HDF5Array)
library(viridis)
library(tidyr)
library(gprofiler2)
library(ggplot2)
library(ggpubr)
library(VennDiagram)
library(ComplexHeatmap)
library(dplyr)
library(gplots)
library(circlize)
source("~/script/plier_util.R")
source("~/script/test_LV_differences.R")
library(dplyr)
```

```{r}
pan_gtex_count_ordered <- readRDS("~/data/pan_gtex_count_ordered.rds")
pan_gtex_metadata_ordered <- readRDS("~/data/pan_gtex_metadata_ordered.rds")
paad_tcga_count_ordered <- readRDS("~/data/paad_tcga_count_ordered.rds")
paad_tcga_metadata_ordered <- readRDS("~/data/paad_tcga_metadata_ordered.rds")
```

```{r}
colnames(paad_tcga_count_ordered)<- paad_tcga_metadata_ordered$external_id
```

PANCREAS cancer vs normal 
things to add to metadata- database, tumor/normal, subtype, sex

```{r}
#order the tcga data to match recount3 order
ids <- paad_tcga_metadata_ordered$external_id

nam <- c()
status<- c()
sex<- c()
for (i in 1:length(ids)){
  
nam[i]<- ids[i]
#create tumor/normal col
status[i] <- paad_tcga_metadata_ordered$cgc_sample_sample_type[paad_tcga_metadata_ordered$external_id == ids[i]]
#create sex col 
sex[i]<- paad_tcga_metadata_ordered$cgc_case_gender[paad_tcga_metadata_ordered$external_id== ids[i]]
}
#create database col
database <- rep("TCGA", length(sex))
#create metadata 
tcga_paad_metadata<- as.data.frame(cbind(nam, database, status,  sex))
rownames(tcga_paad_metadata) <- ids
tcga_paad_metadata[1:5,]
```
```{r}
#order the metadata to match recount3 order
#create sex col 
identical (pan_gtex_metadata_ordered$external_id, colnames( pan_gtex_count_ordered))
nam<- pan_gtex_metadata_ordered$external_id
sex<- ifelse(pan_gtex_metadata_ordered$SEX == 1, "male", "female")
#create database col
database<- rep ("GTEx",length(sex) )
#create normal col
status<- rep ("Solid Tissue Normal", length(sex))
#create metadata 
gtex_metadata<- as.data.frame(cbind(nam, database, status, sex))
rownames(gtex_metadata)<- pan_gtex_metadata_ordered$external_id
#combine count and metadata
gtex_metadata[1:5,]
```

```{r}
all_metadata <- rbind(tcga_paad_metadata, gtex_metadata)
rownames(all_metadata)<- c(rownames(tcga_paad_metadata), rownames(gtex_metadata))
count_table<- cbind(paad_tcga_count_ordered, pan_gtex_count_ordered)
```

```{r}
identical(rownames(all_metadata), colnames(count_table))
```


the other tumor class...
#grep("NEUROENDOCRINE",recount3_rse_PAAD@colData$tcga.cgc_case_other_histological_diagnosis, ignore.case = TRUE)
```{r}
id_list <-paad_tcga_metadata_ordered$external_id[ grep("NEUROENDOCRINE",paad_tcga_metadata_ordered$cgc_case_other_histological_diagnosis, ignore.case = TRUE)]
all_metadata_v2<- all_metadata[! all_metadata$nam %in% id_list ,]
count_table_v2<- count_table[, !all_metadata$nam %in% id_list ]
```

```{r}
dim(all_metadata)
dim(all_metadata_v2)
dim(count_table_v2)
dim(count_table)
```


remove recurrent tumors
```{r}
all_metadata_v3<- all_metadata_v2[!all_metadata_v2$status == "Metastatic",]
count_table_v3<- count_table_v2[, !all_metadata_v2$status == "Metastatic"]
```


```{r}
dim(all_metadata_v3)
dim(all_metadata_v2)
dim(count_table_v2)
dim(count_table_v3)
```
[1] 533   4
[1] 534   4
[1] 63856   534
[1] 63856   533


LINCS data
```{r}
library(signatureSearch)
library(HDF5Array)
se <- SummarizedExperiment(HDF5Array("~/data/lincs_2020.h5", name="assay"))
```

```{r eval=FALSE}
rownames(se) <- HDF5Array("~/data/lincs_2020.h5", name="rownames")
colnames(se) <- HDF5Array("~/data/lincs_2020.h5", name="colnames")
```

```{r eval=FALSE}
se_asssay<- assay(se)
```

path to LINCS databse for singature reversion
```{r}
db_path <- "~/data/lincs_2020.h5"
```

### Analysis
#### Deseq2
deseq2 with raw counts
DESEq2 (make into a function )

```{r}
library(DESeq2)
```


```{r eval=FALSE}
dds_paad_normal <- DESeqDataSetFromMatrix(countData = count_table_v3,
                              colData = all_metadata_v3,
                              design= ~ database + status)
```


```{r eval=FALSE}
deseq2_paad_normal <- deseq2_function(dds_paad_normal, "~/output/pancreas_cancer/deseq2_res/Deseq2_paad_normal_gtx_res.csv", "status", "Primary Tumor", "Solid Tissue Normal")
```
signaturesearch 
Genes
```{r}
feature_info <- readRDS("~/data/recount3/recount3_fix_download/feature_info.rds")
```


```{r eval=FALSE}
identical(feature_info $gene_id, rownames(deseq2_paad_normal))
```

```{r eval=FALSE}
deseq2_paad_normal$Symbol<- feature_info$gene_name
```

```{r eval=FALSE}
deseq2_paad_normal<- deseq2_paad_normal[!is.na(deseq2_paad_normal$padj),]
deseq_results_sig_top <- deseq2_paad_normal[deseq2_paad_normal$padj < 0.05 & deseq2_paad_normal$log2FoldChange > 0,]
deseq_results_sig_bottom <- deseq2_paad_normal[deseq2_paad_normal$padj < 0.05 & deseq2_paad_normal$log2FoldChange < 0,]
```

```{r eval=FALSE}
downset<- deseq_results_sig_bottom$Symbol[deseq_results_sig_bottom$log2FoldChange < -1.5]
upset<- deseq_results_sig_top$Symbol[deseq_results_sig_top$log2FoldChange >1.5] 
```

convert gene symbols to LINCS genes
```{r eval=FALSE}
upset_v2 <- match_to_LINCS_genes(upset)
downset_v2 <- match_to_LINCS_genes(downset)
```

```{r eval=FALSE}
downset_v2<- downset_v2[!is.na(downset_v2)]
upset_v2<- upset_v2[!is.na(upset_v2)]
```

```{r eval=FALSE}
#double check that they didn't overlap 
 intersect(downset_v2, upset_v2)
```


```{r eval=FALSE}
names(upset_v2)<- NULL
names(downset_v2)<- NULL
```
```{r eval=FALSE}
deseq_paad_list<- list(up= upset_v2, down= downset_v2)
```

```{r eval=FALSE}
saveRDS(deseq_paad_list,"~/output/pancreas_cancer/deseq2_res/SR_gene_list_paad_deseq2.rds")
```


```{r eval=FALSE}
set.seed(101)
qsig_lincs_deseq2_res <- qSig(query=list(upset=as.character(upset_v2), downset=as.character(downset_v2)), 
                   gess_method="LINCS", refdb=db_path)
```


```{r eval=FALSE}
set.seed(101)
lincs_deseq <- gess_lincs(qsig_lincs_deseq2_res, sortby="NCS")
#result(lincs)
```



```{r eval=FALSE}
lincs_deseq_paad_res <- result(lincs_deseq)
```

```{r eval=FALSE}
write.csv(lincs_deseq_paad_res, file= "~/output/pancreas_cancer/deseq2_res/220929_SR_LINCS_PAAD_DESEQ2_RES.csv" )
```

```{r eval=FALSE}
lincs_deseq_paad_res_YAPC <- lincs_deseq_paad_res[lincs_deseq_paad_res$cell == "YAPC",]
```
tau 
```{r eval=FALSE}
YAPC_taudf <- readRDS("~/data/YAPC_taudf.rds")
```


```{r eval=FALSE}
tau_test<- tau_scores(lincs_deseq_paad_res_YAPC , YAPC_taudf)
```

```{r eval=FALSE}
lincs_deseq_paad_res_YAPC$jlf_tau<- tau_test
```

```{r eval=FALSE}
lincs_deseq_paad_res_YAPC_top <- lincs_deseq_paad_res_YAPC[lincs_deseq_paad_res_YAPC$NCS < 0 & lincs_deseq_paad_res_YAPC$WTCS_FDR < 0.05 & lincs_deseq_paad_res_YAPC$jlf_tau< -80,]
```

FDA approved and clinical trials

```{r eval=FALSE}
lincs_deseq_paad_res_YAPC_top$fda_approved<- FDA_APPROVAL_CHECK(lincs_deseq_paad_res_YAPC_top$pert)
```


```{r eval=FALSE}
clinical_trial_PAAD <- read.csv("~/data/SearchResults_PAAD.csv")
```


```{r eval=FALSE}
lincs_deseq_paad_res_YAPC_top$clinical_trial_PAAD <- clinical_trial_check(lincs_deseq_paad_res_YAPC_top$pert, clinical_trial_PAAD)
```


```{r eval=FALSE}
lincs_deseq_paad_res_YAPC_top_fda<- lincs_deseq_paad_res_YAPC_top[lincs_deseq_paad_res_YAPC_top$fda_approved,]
#lincs_deseq_paad_res_YAPC_top_fda$clinical_trial_PAAD<- ifelse(lincs_deseq_paad_res_YAPC_top_fda$clinical_trial_PAAD, "star", "")

lincs_deseq_paad_res_YAPC_top_fda_order <- lincs_deseq_paad_res_YAPC_top_fda[order(-lincs_deseq_paad_res_YAPC_top_fda$NCS),]
lincs_deseq_paad_res_YAPC_top_fda$pert <- factor(lincs_deseq_paad_res_YAPC_top_fda$pert, levels = lincs_deseq_paad_res_YAPC_top_fda_order$pert)
p<-ggplot(data=lincs_deseq_paad_res_YAPC_top_fda, aes(x=pert, y=NCS, fill=jlf_tau, shape= clinical_trial_PAAD)) +
  geom_bar(stat="identity", color = "black")+ scale_fill_viridis(direction=-1) + geom_point(aes(y = NCS - 0.15), position = position_dodge(0.9), size= 4, show.legend = TRUE)
p + coord_flip()  + ylab("Normalized Connectivity Score") + xlab("LINCS Small Molecules") +labs(fill = "Tau [-100,100]", shape= "Clinical Trials")

ggsave("~/output/pancreas_cancer/deseq2_res/220929_ggplot_deseq2_tau_paad_approved_candidates.png")
```
```{r}
knitr::include_graphics("~/output/pancreas_cancer/deseq2_res/220929_ggplot_deseq2_tau_paad_approved_candidates.png")
```


```{r eval=FALSE}
#lincs_deseq_paad_res_YAPC_top 
write.csv(lincs_deseq_paad_res_YAPC_top , file= "~/output/pancreas_cancer/deseq2_res/220929_SR_LINCS_PAAD_DESEQ2_RES_tau.csv" )
```

pathways

```{r eval=FALSE}

hyperG_k_res <- dsea_hyperG(drugs = lincs_deseq_paad_res_YAPC_top_fda$pert, type = "KEGG", pvalueCutoff = 1, qvalueCutoff = 1,  minGSSize = 10, maxGSSize = 2000)
hyperG_k_res_v2<- result(hyperG_k_res)
```

```{r eval=FALSE}
#false discovery rate
hyperG_k_res_v2$logqvalue<- -log(hyperG_k_res_v2$qvalue)
```

```{r eval=FALSE}
hyperG_k_res_v2$Description<- factor(hyperG_k_res_v2$Description, levels= hyperG_k_res_v2$Description)
```

```{r eval=FALSE}
gbm.2<-ggplot(data=hyperG_k_res_v2[1:30,] , aes(x=Description, y=Count, fill=logqvalue )) +
  geom_bar(stat="identity") + scale_fill_viridis()
gbm.2 + coord_flip() + ylab("Number of Drugs") + xlab("KEGG Pathways") +labs(fill = "-log(q-value)")
```

```{r eval=FALSE}
write.csv(hyperG_k_res_v2 , file= "~/output/pancreas_cancer/deseq2_res/220929_SR_LINCS_PAAD_DESEQ2_PATHWAY.csv" )
```


plotting the drug targets

```{r eval=FALSE}
tpm_table<- Counts_to_tpm(count_table_v3, feature_info$bp_length)
```

```{r eval=FALSE}
rownames(tpm_table)<- feature_info$gene_name
```

```{r eval=FALSE}
tpm_df <- as.data.frame(tpm_table)
```



look at all the drug target for this method/cancer
```{r eval=FALSE}
deseq2_paad_normal<- cbind(rownames(deseq2_paad_normal), deseq2_paad_normal)
for (i in 1:nrow(lincs_deseq_paad_res_YAPC_top_fda) ){
  targets<- as.vector(unlist(strsplit(lincs_deseq_paad_res_YAPC_top_fda$t_gn_sym[i], "; ")))
  #print(targets)
  try(drug_analysis( lincs_deseq_paad_res_YAPC_top_fda$pert[i], targets, tpm_df , all_metadata_v3$status, deseq2_paad_normal, se= se_asssay, cell_lincs= "__YAPC__trt_cp", "~/output/pancreas_cancer/deseq2_res/220929_candidate_plots"))
}
```


PRISM

```{r eval=FALSE}
primary_paad_res <-read.csv( file= "~/output/pancreas_cancer/220808_prism_paad_candidates.csv" )
```

```{r eval=FALSE}
primary_paad_res_sub <-primary_paad_res[ primary_paad_res$Var2 %in% lincs_deseq_paad_res_YAPC_top_fda$pert,]
primary_paad_res_sub$Var2 <- factor(primary_paad_res_sub$Var2, levels=unique(primary_paad_res_sub$Var2[order(-primary_paad_res_sub$log_fold_change)]))
ggplot(primary_paad_res_sub, aes(x=log_fold_change, y= Var2))+ geom_violin() +geom_vline(xintercept = 0.3)  + ylab("Drug Candidates") + xlab("log fold change")
ggsave("~/output/pancreas_cancer/deseq2_res/220929_ggplot_deseq2_candidates_prism_screen1.png")
```
```{r}
knitr::include_graphics("~/output/pancreas_cancer/deseq2_res/220929_ggplot_deseq2_candidates_prism_screen1.png")
```

```{r eval=FALSE}
drug_list <- as.vector(unique(primary_paad_res_sub$Var2))
drug_fraction<- c()
for (i in 1:length(drug_list)){
  cells <-primary_paad_res_sub$Sensitive[primary_paad_res_sub$Var2 %in% drug_list[i]]
  cells<- cells[!is.na(cells)]
  if( length(cells) < 12){
    print(drug_list[i])
  }
  #x<- table(cells)
  drug_fraction[i] <- length(cells[cells== TRUE])/ length(cells)
}
test <- ifelse(drug_fraction > 0.75, TRUE, FALSE)
drug_senstive_precentage_all_drugs <- data.frame(drug_fraction, drug_list, test)
drug_senstive_precentage_all_drugs$drug_list<- factor(drug_senstive_precentage_all_drugs$drug_list, levels= unique(drug_senstive_precentage_all_drugs$drug_list[order(drug_senstive_precentage_all_drugs$drug_fraction)]))
ggplot(drug_senstive_precentage_all_drugs, aes( drug_fraction, drug_list, fill= test ))+ geom_bar(stat="identity", color = "black") + scale_fill_viridis_d() + ylab("Drug Candidates") + xlab("Fraction of Sensitive Cell Lines") +labs(fill = "75% of Cell line are Sensitive")
ggsave("~/output/pancreas_cancer/deseq2_res/220929_ggplot_deseq2_candidates_prism_screen1_sensitive_cell_lines.png")
```
```{r}
knitr::include_graphics("~/output/pancreas_cancer/deseq2_res/220929_ggplot_deseq2_candidates_prism_screen1_sensitive_cell_lines.png")
```


```{r eval=FALSE}
len<- length(lincs_deseq_paad_res_YAPC_top_fda$pert)
num_clin <- nrow(lincs_deseq_paad_res_YAPC_top_fda[lincs_deseq_paad_res_YAPC_top_fda$clinical_trial_PAAD == TRUE,])
fract<- num_clin/len
deseq2_CT_test_res <- clinical_trial_testing(101, "YAPC", len, fract , clinical_trial_PAAD)
```


```{r eval=FALSE}
drug_list <- as.vector(unique(primary_paad_res$Var2))
drug_fraction<- c()
for (i in 1:length(drug_list)){
  cells <-primary_paad_res$Sensitive[primary_paad_res$Var2 %in% drug_list[i]]
  cells<- cells[!is.na(cells)]
  if( length(cells) < 12){
    print(drug_list[i])
  }
  #x<- table(cells)
  drug_fraction[i] <- length(cells[cells== TRUE])/ length(cells)
}
test <- ifelse(drug_fraction > 0.75, TRUE, FALSE)
drug_senstive_precentage_all_drugs <- data.frame(drug_fraction, drug_list, test)
```


```{r eval=FALSE}
deseq2_PRISM_test<- PRISM_testing(101,"YAPC", lincs_deseq_paad_res_YAPC_top_fda$pert, drug_senstive_precentage_all_drugs)
```
```{r eval=FALSE}
deseq2_PRISM_test
```


#### limma
limma with tpm counts
normalize count data by tpm

```{r eval=FALSE}
TPM <- log2(as.matrix(tpm_df) + 1)

```

LVTestWrapperJLF <- function(b.matrix,
                          sample.info.df,
                          phenotype.col,
                          blocking,
                          file.lead,
                          plot.dir = "plots",
                          results.dir = "results",
                          use.bonferroni = FALSE,
                          significant.only = FALSE,
                          sig.threshold = 0.05)
                          

                          
```{r eval=FALSE}
sampleinfo<- cbind(colnames(TPM), as.character(all_metadata_v3$status), as.character(all_metadata_v3$database))
colnames(sampleinfo) <- c("Sample", "Tumor","database")
sampleinfo<- as.data.frame(sampleinfo)
database<- all_metadata_v3$database
names(database)<- colnames(TPM)

limma_gene_TCGA_BH <- LVTestWrapperJLF_v2(b.matrix=TPM , sample.info.df= sampleinfo, phenotype.col= "Tumor", blocking= database, file.lead= "220808_limma_TCGA_GTEX_T_vs_NT_pancreas_cancer", plot.dir= "~/output/limma_gbm/", results.dir= "~/output/pancreas_cancer/limma_res/", use.bonferroni= FALSE, sig.threshold = 0.05)
```


```{r eval=FALSE}
saveRDS(limma_gene_TCGA_BH , file= "~/output/pancreas_cancer/limma_res/220808_PAAD_GTEX_gene_limma_res.rds")
```

signaturesearch 

```{r eval=FALSE}
limma_res <- limma_gene_TCGA_BH$limma
```

```{r eval=FALSE}
limma_results<- limma_res[complete.cases(limma_res),]
limma_results_sig <- limma_results[limma_results$adj.P.Val < 0.05 & abs(limma_results$logFC) > 1.6,]
```

```{r eval=FALSE}
downset<- limma_results_sig$LV[ limma_results_sig$logFC < -1.6]
upset<- limma_results_sig$LV[limma_results_sig$logFC > 1.6]
```


```{r eval=FALSE}
upset_v2 <- match_to_LINCS_genes(upset)
downset_v2 <- match_to_LINCS_genes(downset)
```

```{r eval=FALSE}
downset_v2<- downset_v2[complete.cases(downset_v2)]
upset_v2<- upset_v2[complete.cases(upset_v2)]
```

```{r eval=FALSE}
#double check that they didn't overlap 
 intersect(downset_v2, upset_v2)
```

```{r eval=FALSE}
length(downset_v2)
length(upset_v2)
```

```{r eval=FALSE}
names(upset_v2)<- NULL
names(downset_v2)<- NULL
```

```{r eval=FALSE}
limma_paad_list<- list(up= upset_v2, down= downset_v2)
```

```{r eval=FALSE}
saveRDS(limma_paad_list,"~/output/pancreas_cancer/limma_res/SR_gene_list_paad_limma.rds")
```


```{r eval=FALSE}
set.seed(101)
qsig_lincs_limma_pancreas_res <- qSig(query=list(upset=as.character(upset_v2), downset=as.character(downset_v2)), 
                   gess_method="LINCS", refdb=db_path)
```


```{r eval=FALSE}
set.seed(101)
library(parallel)
lincs_limma_pancreas <- gess_lincs(qsig_lincs_limma_pancreas_res, sortby="NCS", tau=FALSE)
#result(lincs)
```



```{r eval=FALSE}
lincs_limma_pancreas_res <- result(lincs_limma_pancreas)
```

```{r eval=FALSE}
write.csv(lincs_limma_pancreas_res, file= "~/output/pancreas_cancer/limma_res/220808_SR_LINCS_PANCREAS_LIMMA_RES.csv" )
```

```{r eval=FALSE}
lincs_limma_pancreas_res_YAPC <- lincs_limma_pancreas_res[lincs_limma_pancreas_res$cell == "YAPC",]
```
tau 

```{r eval=FALSE}
tau_test<- tau_scores(lincs_limma_pancreas_res_YAPC, YAPC_taudf)
lincs_limma_pancreas_res_YAPC$jlf_tau<- tau_test
```

```{r eval=FALSE}
write.csv(lincs_limma_pancreas_res_YAPC, file= "~/output/pancreas_cancer/limma_res/220808_lincs_limma_pancreas_res_YAPC_tau.csv" )
```

```{r eval=FALSE}
lincs_limma_pancreas_res_YAPC_top <- lincs_limma_pancreas_res_YAPC[lincs_limma_pancreas_res_YAPC$NCS < 0 & lincs_limma_pancreas_res_YAPC$WTCS_FDR < 0.05 & lincs_limma_pancreas_res_YAPC$jlf_tau< -80,]
```

FDA approval and clinical trials

```{r eval=FALSE}
lincs_limma_pancreas_res_YAPC_top$fda_approved<- FDA_APPROVAL_CHECK(lincs_limma_pancreas_res_YAPC_top$pert)
```
```{r eval=FALSE}
lincs_limma_pancreas_res_YAPC_top$clinical_trial_PAAD <- clinical_trial_check(lincs_limma_pancreas_res_YAPC_top$pert, clinical_trial_PAAD)
```


```{r eval=FALSE}
lincs_limma_pancreas_res_YAPC_top_fda<- lincs_limma_pancreas_res_YAPC_top[lincs_limma_pancreas_res_YAPC_top$fda_approved,]
#lincs_deseq_paad_res_YAPC_top_fda$clinical_trial_PAAD<- ifelse(lincs_deseq_paad_res_YAPC_top_fda$clinical_trial_PAAD, "star", "")

lincs_limma_pancreas_res_YAPC_top_fda_order <- lincs_limma_pancreas_res_YAPC_top_fda[order(-lincs_limma_pancreas_res_YAPC_top_fda$NCS),]
lincs_limma_pancreas_res_YAPC_top_fda$pert <- factor(lincs_limma_pancreas_res_YAPC_top_fda$pert, levels = lincs_limma_pancreas_res_YAPC_top_fda_order$pert)
p<-ggplot(data=lincs_limma_pancreas_res_YAPC_top_fda, aes(x=pert, y=NCS, fill=jlf_tau, shape= clinical_trial_PAAD)) +
  geom_bar(stat="identity", color = "black")+ scale_fill_viridis(direction=-1) + geom_point(aes(y = NCS - 0.15), position = position_dodge(0.9), size= 4, show.legend = TRUE)
p + coord_flip()  + ylab("Normalized Connectivity Score") + xlab("Top 30 LINCS Small Molecules") +labs(fill = "Tau [-100,100]", shape= "Clinical Trials")

ggsave("~/output/pancreas_cancer/limma_res/220808_ggplot_limma_tau_paad_approved_candidates_top_30.png")
```

```{r}
knitr::include_graphics("~/output/pancreas_cancer/limma_res/220808_ggplot_limma_tau_paad_approved_candidates_top_30.png")
```

```{r eval=FALSE}
#lincs_deseq_paad_res_YAPC_top 
write.csv(lincs_limma_pancreas_res_YAPC_top , file= "~/output/pancreas_cancer/limma_res/220808_SR_LINCS_PAAD_limma_RES_tau.csv" )
```

pathways

```{r eval=FALSE}
hyperG_k_res <- dsea_hyperG(drugs = lincs_limma_pancreas_res_YAPC_top_fda$pert, type = "KEGG", pvalueCutoff = 1, qvalueCutoff = 1,  minGSSize = 10, maxGSSize = 2000)
hyperG_k_res_v2<- result(hyperG_k_res)
```

```{r eval=FALSE}
#false discovery rate
hyperG_k_res_v2$logqvalue<- -log(hyperG_k_res_v2$qvalue)
hyperG_k_res_v2$Description<- factor(hyperG_k_res_v2$Description, levels= hyperG_k_res_v2$Description)
```

```{r eval=FALSE}
gbm.2<-ggplot(data=hyperG_k_res_v2[1:30,] , aes(x=Description, y=Count, fill=logqvalue )) +
  geom_bar(stat="identity") + scale_fill_viridis()
gbm.2 + coord_flip() + ylab("Number of Drugs") + xlab("KEGG Pathways") +labs(fill = "-log(q-value)")
```

```{r eval=FALSE}
write.csv(hyperG_k_res_v2 , file= "~/output/pancreas_cancer/limma_res/220808_SR_LINCS_PAAD_limma_PATHWAY.csv" )
```


LINCS pathway & Drug targets

```{r eval=FALSE}
for (i in 1:nrow(lincs_limma_pancreas_res_YAPC_top_fda) ){
  targets<- as.vector(unlist(strsplit(lincs_limma_pancreas_res_YAPC_top_fda$t_gn_sym[i], "; ")))
  #print(targets)
  try(drug_analysis( lincs_limma_pancreas_res_YAPC_top_fda$pert[i], targets, tpm_df , all_metadata_v3$status, deseq2_paad_normal, se= se_asssay, cell_lincs= "__YAPC__trt_cp", "~/output/pancreas_cancer/limma_res/candidate_plots"))
}
```

PRISM

```{r eval=FALSE}
primary_paad_res_sub <-primary_paad_res[ primary_paad_res$Var2 %in% lincs_limma_pancreas_res_YAPC_top_fda$pert,]
```


```{r eval=FALSE}
write.csv(primary_paad_res_sub , file= "~/output/pancreas_cancer/limma_res/220808_prism_limma_candidates.csv" )
```


```{r eval=FALSE}
primary_paad_res_sub$Var2 <- factor(primary_paad_res_sub$Var2, levels=unique(primary_paad_res_sub$Var2[order(-primary_paad_res_sub$log_fold_change)]))
#primary_paad_res_sub$Var2 <- factor(primary_paad_res_sub$Var2, levels=unique(primary_paad_res_sub$Var2))
ggplot(primary_paad_res_sub, aes(x=log_fold_change, y= Var2))+ geom_violin() +geom_vline(xintercept = 0.3)  + ylab("Drug Candidates") + xlab("log fold change")
ggsave("~/output/pancreas_cancer/limma_res/220808_ggplot_limma_candidates_prism_screen1.png")
```

```{r}
knitr::include_graphics("~/output/pancreas_cancer/limma_res/220808_ggplot_limma_candidates_prism_screen1.png")
```

```{r eval=FALSE}
drug_list <- as.vector(unique(primary_paad_res_sub$Var2))
drug_fraction<- c()
for (i in 1:length(drug_list)){
  cells <-primary_paad_res_sub$Sensitive[primary_paad_res_sub$Var2 %in% drug_list[i]]
  cells<- cells[!is.na(cells)]
  if( length(cells) < 12){
    print(drug_list[i])
  }
  #x<- table(cells)
  drug_fraction[i] <- length(cells[cells== TRUE])/ length(cells)
}
test <- ifelse(drug_fraction > 0.75, TRUE, FALSE)
drug_senstive_precentage_all_drugs <- data.frame(drug_fraction, drug_list, test)
drug_senstive_precentage_all_drugs$drug_list<- factor(drug_senstive_precentage_all_drugs$drug_list, levels= unique(drug_senstive_precentage_all_drugs$drug_list[order(drug_senstive_precentage_all_drugs$drug_fraction)]))
ggplot(drug_senstive_precentage_all_drugs, aes( drug_fraction, drug_list, fill= test ))+ geom_bar(stat="identity", color = "black") + scale_fill_viridis_d() + ylab("Drug Candidates") + xlab("Fraction of Sensitive Cell Lines") +labs(fill = "75% of Cell line are Sensitive")
ggsave("~/output/pancreas_cancer/limma_res/220808_ggplot_limma_candidates_prism_screen1_sensitive_cell_lines_top_30.png")
```

```{r}
knitr::include_graphics("~/output/pancreas_cancer/limma_res/220808_ggplot_limma_candidates_prism_screen1_sensitive_cell_lines_top_30.png")
```

```{r eval=FALSE}
drug_list <- as.vector(unique(primary_paad_res$Var2))
drug_fraction<- c()
for (i in 1:length(drug_list)){
  cells <-primary_paad_res$Sensitive[primary_paad_res$Var2 %in% drug_list[i]]
  cells<- cells[!is.na(cells)]
  if( length(cells) < 12){
    print(drug_list[i])
  }
  #x<- table(cells)
  drug_fraction[i] <- length(cells[cells== TRUE])/ length(cells)
}
test <- ifelse(drug_fraction > 0.75, TRUE, FALSE)
drug_senstive_precentage_all_drugs <- data.frame(drug_fraction, drug_list, test)
```

```{r eval=FALSE}
limma_PRISM_test<- PRISM_testing(101,"YAPC", lincs_limma_pancreas_res_YAPC_top_fda$pert, drug_senstive_precentage_all_drugs)
```
```{r eval=FALSE}
limma_PRISM_test
```

```{r eval=FALSE}
table(lincs_limma_pancreas_res_YAPC_top_fda$clinical_trial_PAAD)
```


```{r eval=FALSE}
len<- length(lincs_limma_pancreas_res_YAPC_top_fda$pert)
num_clin <- nrow(lincs_limma_pancreas_res_YAPC_top_fda[lincs_limma_pancreas_res_YAPC_top_fda$clinical_trial_PAAD == TRUE,])
fract<- num_clin/len
limma_CT_test_res <- clinical_trial_testing(101, "YAPC", len, fract, clinical_trial_PAAD)
```

```{r eval=FALSE}
limma_CT_test_res
```


#### Transfer Learning

```{r eval=FALSE}
recount3_plier_wo<- readRDS("~/data/recount3_plier_wo.rds")
```


```{r eval=FALSE}
#There is a issue with handling genes with zero expression. Best thing to do is to remove the genes
test <- GetOrderedRowNorm(as.matrix(tpm_table),recount3_plier_wo )
zeros<- rownames(test)[!complete.cases(test)]
tpm_table_v2<- tpm_table[!rownames(tpm_table) %in% zeros,]
```

create the b.matrix 
```{r eval=FALSE}
PAAD.GTEx.b.matrix <- GetNewDataB(as.matrix(tpm_table_v2), recount3_plier_wo)
```

```{r eval=FALSE}
saveRDS(PAAD.GTEx.b.matrix, file= "~/output/pancreas_cancer/TFL_res/200808_PAAD_GTEX_B_MATRIX.rds")
```


```{r eval=FALSE}
sampleinfo<- cbind(colnames(PAAD.GTEx.b.matrix), as.character(all_metadata_v3$status), as.character(all_metadata$database))
colnames(sampleinfo) <- c("Sample", "Tumor","database")
sampleinfo<- as.data.frame(sampleinfo)
database<- all_metadata_v3$database
names(database)<- colnames(PAAD.GTEx.b.matrix)

LV_test_TCGA_BH <- LVTestWrapperJLF(b.matrix=PAAD.GTEx.b.matrix , sample.info.df= sampleinfo, phenotype.col= "Tumor", blocking= database, file.lead= "220808_LV_TCGA_GTEX_T_vs_NT_PAAD", plot.dir= "~/output/pancreas_cancer/TFL_res/", results.dir= "~/output/pancreas_cancer/TFL_res/", use.bonferroni= FALSE, sig.threshold = 0.05)
```

```{r eval=FALSE}
saveRDS(LV_test_TCGA_BH , file= "~/output/pancreas_cancer/TFL_res/220808_PAAD_GTEX_limma_TFL_res.rds")
```


are genes and heatmaps and pathway analysis

```{r eval=FALSE}
sig_LVs <- LV_test_TCGA_BH$limma[LV_test_TCGA_BH$limma$adj.P.Val < 0.05,]
```
```{r eval=FALSE}
hist(LV_test_TCGA_BH$limma$logFC)
```
going with .10 for this analysis 

Wanting to look at the lvs that are show extreme differences 
```{r eval=FALSE}
sd <- sd(LV_test_TCGA_BH$limma$logFC)
mean(LV_test_TCGA_BH$limma$logFC) - (3*sd)
mean(LV_test_TCGA_BH$limma$logFC) + (3*sd)
```
+/- 0.1 seems to be a good threshold


```{r eval=FALSE}
sig_LVs <- LV_test_TCGA_BH$limma[LV_test_TCGA_BH$limma$adj.P.Val < 0.05 & abs(LV_test_TCGA_BH$limma$logFC) > .1 ,]
```

```{r eval=FALSE}
SIG_LVs <- sig_LVs$LV
```

```{r eval=FALSE}
SIG_LVs
```

plot latent variable heatmap 
Latent Variable heatmap 


```{r eval=FALSE}
PAAD_GTEX_B_MATRIX_SIG<- PAAD.GTEx.b.matrix[rownames(PAAD.GTEx.b.matrix ) %in% SIG_LVs, ]
column_ha = HeatmapAnnotation(Sample=all_metadata_v3$status, col = list(Sample = c("Primary Tumor" = "#440154FF", "Solid Tissue Normal" = "#228C8DFF")))
col_fun = colorRamp2(c(-1, 0, 1), c("blue", "black", "yellow"))
Heatmap(PAAD_GTEX_B_MATRIX_SIG, nam= "LV Score",  col = col_fun, show_column_names = FALSE, clustering_distance_rows= "euclidean",
             clustering_distance_columns=  "euclidean",
             clustering_method_rows = "ward.D2" ,
             clustering_method_columns="ward.D2", top_annotation = column_ha, row_names_gp = gpar(fontsize = 8))
```



```{r eval=FALSE}
sig_Z_mt <- recount3_plier_wo$Z[,LV_test_TCGA_BH$limma$adj.P.Val < 0.05 & abs(LV_test_TCGA_BH$limma$logFC)> .1 ]
colnames(sig_Z_mt) <- SIG_LVs
```


top 100 
```{r eval=FALSE}
topgene_1 <- rownames(sig_Z_mt)[order(-sig_Z_mt[,1])][1:30]
topgene_2 <- rownames(sig_Z_mt)[order(-sig_Z_mt[,2])][1:30]
topgene_3 <- rownames(sig_Z_mt)[order(-sig_Z_mt[,3])][1:30]
topgene_4 <- rownames(sig_Z_mt)[order(-sig_Z_mt[,4])][1:30]
topgene_5 <- rownames(sig_Z_mt)[order(-sig_Z_mt[,5])][1:30]
topgene_6 <- rownames(sig_Z_mt)[order(-sig_Z_mt[,6])][1:30]
topgene_7 <- rownames(sig_Z_mt)[order(-sig_Z_mt[,7])][1:30]
topgene_8 <- rownames(sig_Z_mt)[order(-sig_Z_mt[,8])][1:30]
topgene_9 <- rownames(sig_Z_mt)[order(-sig_Z_mt[,9])][1:30]
topgene_10 <- rownames(sig_Z_mt)[order(-sig_Z_mt[,10])][1:30]
```

```{r eval=FALSE}
topgenes<- unique(c(topgene_1, topgene_2,topgene_3, topgene_4, topgene_5, topgene_6, topgene_7, topgene_8, topgene_9, topgene_10))
```


```{r eval=FALSE}
deseq2_paad_tfl <- deseq2_paad_normal[deseq2_paad_normal$Symbol %in% topgenes,]
```


```{r eval=FALSE}
downset<- deseq2_paad_tfl$Symbol[deseq2_paad_tfl$log2FoldChange < 0]
upset<- deseq2_paad_tfl$Symbol[deseq2_paad_tfl$log2FoldChange > 0]
```

```{r eval=FALSE}
upset_v2 <- match_to_LINCS_genes(upset)
downset_v2 <- match_to_LINCS_genes(downset)
```

```{r eval=FALSE}
downset_v2<- downset_v2[complete.cases(downset_v2)]
upset_v2<- upset_v2[complete.cases(upset_v2)]
```

```{r eval=FALSE}
#double check that they didn't overlap 
 intersect(downset_v2, upset_v2)
```

```{r eval=FALSE}
length(downset_v2)
length(upset_v2)
```

```{r eval=FALSE}
names(upset_v2)<- NULL
names(downset_v2)<- NULL
```

```{r eval=FALSE}
tfl_paad_list<- list(up= upset_v2, down= downset_v2)
```

```{r eval=FALSE}
saveRDS(tfl_paad_list,"~/output/pancreas_cancer/TFL_res/SR_gene_list_paad_tfl.rds")
```


```{r eval=FALSE}
set.seed(101)
qsig_lincs_tfl_pancreas_res <- qSig(query=list(upset=as.character(upset_v2), downset=as.character(downset_v2)), 
                   gess_method="LINCS", refdb=db_path)
```


```{r eval=FALSE}
set.seed(101)
library(parallel)
lincs_tfl_pancreas <- gess_lincs(qsig_lincs_tfl_pancreas_res, sortby="NCS", tau=FALSE)
#result(lincs)
```


```{r eval=FALSE}
lincs_tfl_pancreas_res <- result(lincs_tfl_pancreas)
```

```{r eval=FALSE}
write.csv(lincs_tfl_pancreas_res, file= "~/output/pancreas_cancer/220808_SR_LINCS_PANCREAS_TFL_RES.csv" )
```

```{r eval=FALSE}
lincs_tfl_pancreas_res_YAPC <- lincs_tfl_pancreas_res[lincs_tfl_pancreas_res$cell == "YAPC",]
```
tau 
```{r eval=FALSE}
tau_test<- tau_scores(lincs_tfl_pancreas_res_YAPC, YAPC_taudf)
```

```{r eval=FALSE}
lincs_tfl_pancreas_res_YAPC$jlf_tau<- tau_test
```

```{r eval=FALSE}
write.csv(lincs_tfl_pancreas_res_YAPC, file= "~/output/pancreas_cancer/TFL_res/220808_lincs_tfl_pancreas_res_YAPC_tau.csv" )
```

```{r eval=FALSE}
lincs_tfl_pancreas_res_YAPC_top <- lincs_tfl_pancreas_res_YAPC[lincs_tfl_pancreas_res_YAPC$NCS < 0 & lincs_tfl_pancreas_res_YAPC$WTCS_FDR < 0.05 & lincs_tfl_pancreas_res_YAPC$jlf_tau< -80,]
```

annotate fda approval clinical trials

```{r eval=FALSE}
lincs_tfl_pancreas_res_YAPC_top<- lincs_tfl_pancreas_res_YAPC_top[complete.cases(lincs_tfl_pancreas_res_YAPC_top),]
lincs_tfl_pancreas_res_YAPC_top$fda_approved<- FDA_APPROVAL_CHECK(lincs_tfl_pancreas_res_YAPC_top$pert)
```


```{r eval=FALSE}
lincs_tfl_pancreas_res_YAPC_top$clinical_trial_PAAD <- clinical_trial_check(lincs_tfl_pancreas_res_YAPC_top$pert, clinical_trial_PAAD)
```


```{r eval=FALSE}
lincs_tfl_pancreas_res_YAPC_top_fda<- lincs_tfl_pancreas_res_YAPC_top[lincs_tfl_pancreas_res_YAPC_top$fda_approved== TRUE,]
#lincs_deseq_paad_res_YAPC_top_fda$clinical_trial_PAAD<- ifelse(lincs_deseq_paad_res_YAPC_top_fda$clinical_trial_PAAD, "star", "")

lincs_tfl_pancreas_res_YAPC_top_fda_order <- lincs_tfl_pancreas_res_YAPC_top_fda[order(-lincs_tfl_pancreas_res_YAPC_top_fda$NCS),]
lincs_tfl_pancreas_res_YAPC_top_fda$pert <- factor(lincs_tfl_pancreas_res_YAPC_top_fda$pert, levels = lincs_tfl_pancreas_res_YAPC_top_fda_order$pert)
p<-ggplot(data=lincs_tfl_pancreas_res_YAPC_top_fda, aes(x=pert, y=NCS, fill=jlf_tau, shape= clinical_trial_PAAD)) +
  geom_bar(stat="identity", color = "black")+ scale_fill_viridis(direction=-1) + geom_point(aes(y = NCS - 0.15), position = position_dodge(0.9), size= 4, show.legend = TRUE)
p + coord_flip()  + ylab("Normalized Connectivity Score") + xlab("LINCS Small Molecules") +labs(fill = "Tau [-100,100]", shape= "Clinical Trials")

ggsave("~/output/pancreas_cancer/TFL_res/220808_ggplot_tfl_tau_paad_approved_candidates.png")
```

```{r}
knitr::include_graphics("~/output/pancreas_cancer/TFL_res/220808_ggplot_tfl_tau_paad_approved_candidates.png")
```

```{r eval=FALSE}
#lincs_deseq_paad_res_YAPC_top 
write.csv(lincs_tfl_pancreas_res_YAPC_top , file= "~/output/pancreas_cancer/TFL_res/220808_SR_LINCS_PAAD_TFL_RES_tau.csv" )
```

drug target pathways

```{r eval=FALSE}

hyperG_k_res <- dsea_hyperG(drugs = lincs_tfl_pancreas_res_YAPC_top_fda$pert, type = "KEGG", pvalueCutoff = 1, qvalueCutoff = 1,  minGSSize = 10, maxGSSize = 2000)
hyperG_k_res_v2<- result(hyperG_k_res)
```

```{r eval=FALSE}
#false discovery rate
hyperG_k_res_v2$logqvalue<- -log(hyperG_k_res_v2$qvalue)
```

```{r eval=FALSE}
hyperG_k_res_v2$Description<- factor(hyperG_k_res_v2$Description, levels= hyperG_k_res_v2$Description)
```

```{r eval=FALSE}
gbm.2<-ggplot(data=hyperG_k_res_v2[1:30,] , aes(x=Description, y=Count, fill=logqvalue )) +
  geom_bar(stat="identity") + scale_fill_viridis()
gbm.2 + coord_flip() + ylab("Number of Drugs") + xlab("KEGG Pathways") +labs(fill = "-log(q-value)")
```


```{r eval=FALSE}
write.csv(hyperG_k_res_v2 , file= "~/output/pancreas_cancer/TFL_res/220808_SR_LINCS_PAAD_TFL_PATHWAY.csv" )
```


PRISM plotting

```{r eval=FALSE}
primary_paad_res_sub <-primary_paad_res[ primary_paad_res$Var2 %in% lincs_tfl_pancreas_res_YAPC_top_fda$pert,]
write.csv(primary_paad_res_sub , file= "~/output/pancreas_cancer/TFL_res/220808_prism_tfl_candidates.csv" )
```

```{r eval=FALSE}
#primary_paad_res_sub$Var2 <- factor(primary_paad_res_sub$Var2, levels=unique(primary_paad_res_sub$Var2))
primary_paad_res_sub$Var2 <- factor(primary_paad_res_sub$Var2, levels=unique(primary_paad_res_sub$Var2[order(primary_paad_res_sub$log_fold_change)]))
ggplot(primary_paad_res_sub, aes(x=log_fold_change, y= Var2))+ geom_violin() +geom_vline(xintercept = 0.3)  + ylab("Drug Candidates") + xlab("log fold change")
ggsave("~/output/pancreas_cancer/TFL_res/220808_ggplot_TFL_candidates_prism_screen1.png")
```

```{r}
knitr::include_graphics("~/output/pancreas_cancer/TFL_res/220808_ggplot_TFL_candidates_prism_screen1.png")
```

look at the number of sensitive cell lines
```{r eval=FALSE}
drug_list <- as.vector(unique(primary_paad_res_sub$Var2))
drug_fraction<- c()
for (i in 1:length(drug_list)){
  cells <-primary_paad_res_sub$Sensitive[primary_paad_res_sub$Var2 %in% drug_list[i]]
  cells<- cells[!is.na(cells)]
  if( length(cells) < 12){
    print(drug_list[i])
  }
  #x<- table(cells)
  drug_fraction[i] <- length(cells[cells== TRUE])/ length(cells)
}
test <- ifelse(drug_fraction > 0.75, TRUE, FALSE)
drug_senstive_precentage_all_drugs <- data.frame(drug_fraction, drug_list, test)
drug_senstive_precentage_all_drugs$drug_list<- factor(drug_senstive_precentage_all_drugs$drug_list, levels= unique(drug_senstive_precentage_all_drugs$drug_list[order(drug_senstive_precentage_all_drugs$drug_fraction)]))
ggplot(drug_senstive_precentage_all_drugs, aes( drug_fraction, drug_list, fill= test ))+ geom_bar(stat="identity", color = "black") + scale_fill_viridis_d() + ylab("Drug Candidates") + xlab("Fraction of Sensitive Cell Lines") +labs(fill = "75% of Cell line are Sensitive")
ggsave("~/output/pancreas_cancer/TFL_res/220808_ggplot_TFL_candidates_prism_screen1_sensitive_cell_lines.png")
```

```{r}
knitr::include_graphics("~/output/pancreas_cancer/TFL_res/220808_ggplot_TFL_candidates_prism_screen1_sensitive_cell_lines.png")
```

LINCS pathways & Drug targets
```{r eval=FALSE}
for (i in 1:nrow(lincs_tfl_pancreas_res_YAPC_top_fda) ){
  targets<- as.vector(unlist(strsplit(lincs_tfl_pancreas_res_YAPC_top_fda$t_gn_sym[i], "; ")))
  #print(targets)
  try(drug_analysis( lincs_tfl_pancreas_res_YAPC_top_fda$pert[i], targets, tpm_df , all_metadata_v3$status, deseq2_paad_normal, se= se_asssay, cell_lincs= "__PAAD__trt_cp", "~/output/pancreas_cancer/TFL_res/candidate_plots"))
}
```

test the PRISM and number of clinical trail drugs to random drug selection
```{r eval=FALSE}
drug_list <- as.vector(unique(primary_paad_res$Var2))
drug_fraction<- c()
for (i in 1:length(drug_list)){
  cells <-primary_paad_res$Sensitive[primary_paad_res$Var2 %in% drug_list[i]]
  cells<- cells[!is.na(cells)]
  if( length(cells) < 12){
    print(drug_list[i])
  }
  #x<- table(cells)
  drug_fraction[i] <- length(cells[cells== TRUE])/ length(cells)
}
test <- ifelse(drug_fraction > 0.75, TRUE, FALSE)
drug_senstive_precentage_all_drugs <- data.frame(drug_fraction, drug_list, test)
```
PRISM test
```{r eval=FALSE}
tfl_PRISM_test<- PRISM_testing(101,"YAPC", lincs_tfl_pancreas_res_YAPC_top_fda$pert, drug_senstive_precentage_all_drugs)
```

```{r eval=FALSE}
tfl_PRISM_test
```

```{r eval=FALSE}
table(lincs_tfl_pancreas_res_YAPC_top_fda$clinical_trial_PAAD)
```
clinical trials test
```{r eval=FALSE}
len<- length(lincs_tfl_pancreas_res_YAPC_top_fda$pert)
num_clin <- nrow(lincs_tfl_pancreas_res_YAPC_top_fda[lincs_tfl_pancreas_res_YAPC_top_fda$clinical_trial_PAAD == TRUE,])
fract<- num_clin/len
tfl_CT_test_res <- clinical_trial_testing(101, "YAPC", len, fract, clinical_trial_PAAD)
```

```{r eval=FALSE}
tfl_CT_test_res
```


compare gene list across the different methods

```{r eval=FALSE}
venn_dia_methods(limma_paad_list$up, deseq_paad_list$up, tfl_paad_list$up, file_name='~/output/pancreas_cancer/SR_up_genes_venn_diagram.png' )
```

```{r eval=FALSE}
venn_dia_methods(limma_paad_list$down, deseq_paad_list$down, tfl_paad_list$down, file_name='~/output/pancreas_cancer/SR_down_genes_venn_diagram.png' )
```

```{r eval=FALSE}
venn_dia_methods(unlist(limma_paad_list), unlist(deseq_paad_list), unlist(tfl_paad_list), file_name='~/output/pancreas_cancer/SR_all_genes_venn_diagram.png' )
```

compare candidates

```{r eval=FALSE}
venn_dia_methods(lincs_limma_pancreas_res_YAPC_top_fda$pert, lincs_deseq_paad_res_YAPC_top_fda$pert, lincs_tfl_pancreas_res_YAPC_top_fda$pert, file_name='~/output/pancreas_cancer/SR_drug_candidates_venn_diagram.png' )
```



### Save Data
done within the script 

### Save Figures
done within the script 
    
# END
    Location of final scripts:
    script 
    
    Location of data produced:
    ~/output/pancreas_cancer/
    
    Dates when operations were done:
    220808
    
## Versions
```{r}
sessionInfo()
```





