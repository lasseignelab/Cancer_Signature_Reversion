---
title: "220608_gbm_CT_PRSIM_UPDATE"
author: "Jennifer Fisher"
date: "6/8/2022"
output:
  html_document:
    toc: true
    theme: united
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# START 
    Goal/Purpose of operations: 
    quick summary 
    
    Finished psedocode on: Date
    
    System which operations were done on: my laptop(on cheaha), lab mac etc... 
    
    GitHub Repo:
    
    Directory of operations: /path
    
    Scripts being edited for operations: filename(s)
    
    Data being used: description and location
    
    Papers and tools: deseq with paper 

# STEPS
### Set working directory 
### load in data

```{r}
limma_gbm_list <- readRDS("~/output/limma_gbm/SR_gene_list_gbm_limma.rds")
deseq_gbm_list <- readRDS("~/output/deseq2_gbm/SR_gene_list_gbm_deseq2.rds")
tfl_gbm_list <- readRDS("~/output/TF_L_GBM/22004_SR_gene_list_gbm_tfl.rds")
```

compare gene list across the different methods

```{r}
venn_dia_methods(limma_gbm_list$up, deseq_gbm_list$up, tfl_gbm_list$up, file_name='~/output/gbm_plots/SR_up_genes_venn_diagram.png' )
```

```{r}
venn_dia_methods(limma_gbm_list$down, deseq_gbm_list$down, tfl_gbm_list$down, file_name='~/output/gbm_plots/SR_down_genes_venn_diagram.png' )
```

```{r}
venn_dia_methods(unlist(limma_gbm_list), unlist(deseq_gbm_list), unlist(tfl_gbm_list), file_name='~/output/gbm_plots/SR_all_genes_venn_diagram.png' )
```




```{r}
limma_gbm_pathway_res <- method_up_down_gene_set_analysis(limma_gbm_list$up, limma_gbm_list$down, "~/output/gbm_plots/", "limma", "GBM_cancer_limma_input_genes_SR")
```

```{r}
deseq2_gbm_pathway_res<- method_up_down_gene_set_analysis(deseq_gbm_list$up, deseq_gbm_list$down, "~/output/gbm_plots/", "DESEq2", "gbm_cancer_deseq2_input_genes_SR")
```

```{r}
tfl_gbm_pathway_res<- method_up_down_gene_set_analysis(tfl_gbm_list$up, tfl_gbm_list$down, "~/output/gbm_plots/", "TFL", "gbm_cancer_tfl_input_genes_SR")
```


```{r}
limma<- limma_gbm_pathway_res$term_id[ limma_gbm_pathway_res$set == "Up"]
deseq2<- deseq2_gbm_pathway_res$term_id[ deseq2_gbm_pathway_res$set == "Up"]
tfl<-tfl_gbm_pathway_res$term_id[ tfl_gbm_pathway_res$set == "Up"]
venn_dia_methods(limma, deseq2, tfl, file_name='~/output/gbm_plots/SR_gbm_Up_pathway_venn_diagram.png' )
```

```{r}
limma<- limma_gbm_pathway_res$term_id[ limma_gbm_pathway_res$set == "Down"]
deseq2<- deseq2_gbm_pathway_res$term_id[ deseq2_gbm_pathway_res$set == "Down"]
tfl<-tfl_gbm_pathway_res$term_id[ tfl_gbm_pathway_res$set == "Down"]
venn_dia_methods(limma, deseq2, tfl, file_name='~/output/gbm_plots/SR_gbm_Down_pathway_venn_diagram.png' )
```

```{r}
limma<- limma_gbm_pathway_res$term_id
deseq2<- deseq2_gbm_pathway_res$term_id
tfl<-tfl_gbm_pathway_res$term_id
venn_dia_methods(limma, deseq2, tfl, file_name='~/output/gbm_plots/SR_gbm_all_pathway_venn_diagram.png' )
```


```{r eval=FALSE}
lincs_limma_gbm_res_GI1_fda_approved<- read_csv( "~/output/limma_GBM/220808_SR_LINCS_GBM_top_RES_all.csv")
lincs_deseq_gbm_res_GI1_fda_approved<- read_csv( "~/output/deseq2_gbm/220427_SR_LINCS_GBM_DESEQ2_RES_all.csv")
lincs_tfl_gbm_res_GI1_fda_approved<- read_csv( "~/output/TF_L_GBM/220808_SR_LINCS_GBM_top_RES_all.csv")
```


```{r}
venn_dia_methods(lincs_limma_gbm_res_GI1_fda_approved$pert, lincs_deseq_gbm_res_GI1_fda_approved$pert, lincs_tfl_gbm_res_GI1_fda_approved$pert, file_name='~/output/gbm_plots/SR_drug_candidates_venn_diagram.png' )
```
```{r}
clinical_trial_cancer_summary <- read_csv("~/output/220608_clinical_trial_cancer_summary.csv")
```

```{r}
clinical_trial_cancer_summary_v2 <- clinical_trial_cancer_summary %>% pivot_longer(c(CT, Not_Cl),names_to= "type" )
clinical_trial_cancer_summary_v2$type <- ifelse(clinical_trial_cancer_summary_v2$type == "CT", "Clinical Trial", "Not in Clinical Trial" )
```


```{r}
clinical_trial_cancer_summary$number <-  ifelse(clinical_trial_cancer_summary$significant== TRUE, (clinical_trial_cancer_summary$CT +clinical_trial_cancer_summary$Not_Cl), NA)
clinical_trial_cancer_summary$symbol <- ifelse(clinical_trial_cancer_summary$significant== TRUE, "*", "")
#clinical_trial_cancer_summary$cancer

labels <- clinical_trial_cancer_summary_v2$significant == TRUE & clinical_trial_cancer_summary_v2$type =="Clinical Trial"
labels_v2 <- ifelse(labels == "TRUE", "*", "")
clinical_trial_cancer_summary_v2$labels_v2<- labels_v2
```


```{r}
clinical_trial_gbm <- clinical_trial_cancer_summary_v2[clinical_trial_cancer_summary_v2$cancer == "Glioblastoma",]
t <- ggplot(clinical_trial_gbm ,aes(x=method,y=value,fill=type, label= value))+
  geom_bar(stat = "identity",color="white")+
  #facet_wrap(~cancer,ncol=1) +                                                              # Add values on top of bars
  geom_text(size = 5, position = position_stack(vjust = 0.5)) + scale_fill_manual(values= c("#FDE725FF","#21908CFF")) + ylab("Number of Drug Candidates")
t + geom_text(aes(label=labels_v2),vjust=- 15,  size= 10)

```






```{r}
prism_deseq2_candidates_gbm <- read.csv( "~/output/TF_L_GBM/220808_prism_deseq2_candidates_gbm.csv")
prism_tfl_candidates_gbm <- read.csv( "~/output/TF_L_GBM/220808_prism_tfl_candidates_gbm.csv")
prism_limma_candidates_gbm <- read.csv( "~/output/limma_gbm/220808_prism_limma_candidates_gbm.csv")
```
```{r}
#combine and remove duplicates and NAs
prism_candidates_gbm<- rbind(prism_deseq2_candidates_gbm,prism_tfl_candidates_gbm ,  prism_limma_candidates_gbm)
prism_candidates_gbm<- prism_candidates_gbm[!duplicated(prism_candidates_gbm),]
prism_candidates_gbm <- prism_candidates_gbm[!is.na(prism_candidates_gbm$log_fold_change),]
```


```{r}

drug_list <- c(unique(prism_deseq2_candidates_gbm$Var2), unique(prism_tfl_candidates_gbm$Var2), unique(prism_limma_candidates_gbm$Var2))

drug_median<- c()
for (i in 1:length(drug_list)){
  cells <- prism_candidates_gbm$log_fold_change[prism_candidates_gbm$Var2 %in% drug_list[i]]
  drug_median[i] <- median(cells)
}
drug_prism_median_all_drugs <- data.frame( drug_list, drug_median)
methods<- c(rep("DESeq2", length(unique(prism_deseq2_candidates_gbm$Var2))),  rep("Transfer Learning", length(unique(prism_tfl_candidates_gbm$Var2))),  rep("limma", length(unique(prism_limma_candidates_gbm$Var2))))
drug_prism_median_all_drugs$methods<- methods
```


```{r}
t <- ggplot(drug_prism_median_all_drugs ,aes(x=methods, y=drug_median ,fill=methods))+
  #geom_point()+
  geom_violin() +
  geom_boxplot(width = 0.1, fill = "grey", color = "black") + scale_fill_manual(values= c("#440154FF" ,"#21908CFF" ,"#FDE725FF"))  +
   ylab("Median log2fold change (PRISM)") + geom_hline(yintercept=0.3, linetype="dashed", color = "red")
#t + geom_text(aes(label=labels_v2),vjust=- 15,  size= 10) +ylim(0, 90)
t
```




#tfl_Prism
```{r}
primary_paad_res_sub <-primary_paad_res[ primary_paad_res$Var2 %in% lincs_deseq_gbm_res_GI1C_fda_approved$pert,]
```


```{r eval=FALSE}
write.csv(primary_paad_res_sub , file= "~/output/TF_L_GBM/220602_prism_tfl_candidates.csv" )
```

#deseq2_Prism

```{r}
primary_paad_res_sub <-primary_paad_res[ primary_paad_res$Var2 %in% lincs_deseq_gbm_res_GI1_fda_approved$pert,]
```


```{r eval=FALSE}
write.csv(primary_paad_res_sub , file= "~/output/deseq2_gbm/220602_prism_deseq2_candidates.csv" )
```

#limma_Prism

```{r}
primary_paad_res_sub <-primary_paad_res[ primary_paad_res$Var2 %in% lincs_limma_gbm_res_GI1_fda_approved$pert,]
```


```{r eval=FALSE}
write.csv(primary_paad_res_sub , file= "~/output/limma_gbm/220602_prism_limma_candidates.csv" )
```

```{r}
dim(drug_senstive_precentage_all_drugs)
```



```{r}
fraction_cell_line <- drug_senstive_precentage_all_drugs[1:30,]
```


```{r}
fraction_cell_line
```

# fraction first

data wrangle the cancers
```{r}
#Glioblastoma
##deseq2
drug_senstive_precentage_gbm_deseq2_drugs<-drug_senstive_precentage_all_drugs[ drug_senstive_precentage_all_drugs$drug_list %in% lincs_deseq_gbm_res_GI1_fda_approved$pert,]
drug_senstive_precentage_gbm_deseq2_drugs$method <- rep("DESeq2", nrow(drug_senstive_precentage_gbm_deseq2_drugs))
##limma
drug_senstive_precentage_gbm_limma_drugs<-drug_senstive_precentage_all_drugs[ drug_senstive_precentage_all_drugs$drug_list %in% lincs_limma_gbm_res_GI1_fda_approved$pert,]
drug_senstive_precentage_gbm_limma_drugs$method <- rep("limma", nrow(drug_senstive_precentage_gbm_limma_drugs))
##tfl
drug_senstive_precentage_gbm_tfl_drugs<-drug_senstive_precentage_all_drugs[ drug_senstive_precentage_all_drugs$drug_list %in% lincs_deseq_gbm_res_GI1C_fda_approved$pert,]
drug_senstive_precentage_gbm_tfl_drugs$method <- rep("Transfer Learning", nrow(drug_senstive_precentage_gbm_tfl_drugs))

drug_senstive_precentage_gbm_methods<- rbind(drug_senstive_precentage_gbm_tfl_drugs, drug_senstive_precentage_gbm_limma_drugs, drug_senstive_precentage_gbm_deseq2_drugs)
drug_senstive_precentage_gbm_methods$cancer <- rep("Glioblastima", nrow(drug_senstive_precentage_gbm_methods))
```

```{r}
#Liver hepatocellular carcinoma
liver_deseq_tau <- read_csv("~/output/liver_cancer/deseq2_res/220602_SR_LINCS_LIHC_DESEQ2_RES_tau.csv")
liver_deseq_tau_fda_approved <- liver_deseq_tau[liver_deseq_tau$fda_approved == TRUE, ]

liver_limma_tau <- read_csv("~/output/liver_cancer/limma_res/220602_SR_LINCS_LIHC_limma_RES_tau.csv")
liver_limma_tau_fda_approved <- liver_limma_tau[liver_limma_tau$fda_approved == TRUE,]

liver_limma_tau <- read_csv("~/output/liver_cancer/limma_res/220602_SR_LINCS_LIHC_limma_RES_tau.csv")
liver_limma_tau_fda_approved <- liver_limma_tau[liver_limma_tau$fda_approved == TRUE,]

liver_tfl_tau <- read_csv("~/output/liver_cancer/TFL_res/220602_SR_LINCS_LIHC_TFL_RES_tau.csv")
liver_tfl_tau_fda_approved <- liver_tfl_tau[liver_tfl_tau$fda_approved == TRUE,]

##deseq2
drug_senstive_precentage_lihc_deseq2_drugs<-drug_senstive_precentage_all_drugs[ drug_senstive_precentage_all_drugs$drug_list %in% liver_deseq_tau_fda_approved$pert,]
drug_senstive_precentage_lihc_deseq2_drugs$method <- rep("DESeq2", nrow(drug_senstive_precentage_lihc_deseq2_drugs))
##limma
drug_senstive_precentage_lihc_limma_drugs<-drug_senstive_precentage_all_drugs[ drug_senstive_precentage_all_drugs$drug_list %in% liver_limma_tau_fda_approved$pert,]
drug_senstive_precentage_lihc_limma_drugs$method <- rep("limma", nrow(drug_senstive_precentage_lihc_limma_drugs))
##tfl
drug_senstive_precentage_lihc_tfl_drugs<-drug_senstive_precentage_all_drugs[ drug_senstive_precentage_all_drugs$drug_list %in% liver_tfl_tau_fda_approved $pert,]
drug_senstive_precentage_lihc_tfl_drugs$method <- rep("Transfer Learning", nrow(drug_senstive_precentage_lihc_tfl_drugs))

drug_senstive_precentage_lihc_methods<- rbind(drug_senstive_precentage_lihc_tfl_drugs, drug_senstive_precentage_lihc_limma_drugs, drug_senstive_precentage_lihc_deseq2_drugs)
drug_senstive_precentage_lihc_methods$cancer <- rep("Liver hepatocellular carcinoma", nrow(drug_senstive_precentage_lihc_methods))
```

```{r}
#lung adenocaracionoma
lung_deseq_tau <- read_csv("~/output/lung_cancer/deseq2_res/220602_SR_LINCS_LUAD_DESEQ2_RES_tau.csv")
lung_deseq_tau_fda_approved <- lung_deseq_tau[lung_deseq_tau$fda_approved == TRUE, ]

lung_limma_tau <- read_csv("~/output/lung_cancer/limma_res/220602_SR_LINCS_LUAD_limma_RES_tau.csv")
lung_limma_tau_fda_approved <- lung_limma_tau[lung_limma_tau$fda_approved == TRUE,]

lung_limma_tau <- read_csv("~/output/lung_cancer/limma_res/220602_SR_LINCS_LUAD_limma_RES_tau.csv")
lung_limma_tau_fda_approved <- lung_limma_tau[lung_limma_tau$fda_approved == TRUE,]

lung_tfl_tau <- read_csv("~/output/lung_cancer/TFL_res/220602_SR_LINCS_LUAD_TFL_RES_tau.csv")
lung_tfl_tau_fda_approved <- lung_tfl_tau[lung_tfl_tau$fda_approved == TRUE,]

##deseq2
drug_senstive_precentage_luad_deseq2_drugs<-drug_senstive_precentage_all_drugs[ drug_senstive_precentage_all_drugs$drug_list %in% lung_deseq_tau_fda_approved$pert,]
drug_senstive_precentage_luad_deseq2_drugs$method <- rep("DESeq2", nrow(drug_senstive_precentage_luad_deseq2_drugs))
##limma
drug_senstive_precentage_luad_limma_drugs<-drug_senstive_precentage_all_drugs[ drug_senstive_precentage_all_drugs$drug_list %in% lung_limma_tau_fda_approved$pert,]
drug_senstive_precentage_luad_limma_drugs$method <- rep("limma", nrow(drug_senstive_precentage_luad_limma_drugs))
##tfl
drug_senstive_precentage_luad_tfl_drugs<-drug_senstive_precentage_all_drugs[ drug_senstive_precentage_all_drugs$drug_list %in% lung_tfl_tau_fda_approved $pert,]
drug_senstive_precentage_luad_tfl_drugs$method <- rep("Transfer Learning", nrow(drug_senstive_precentage_luad_tfl_drugs))

drug_senstive_precentage_luad_methods<- rbind(drug_senstive_precentage_luad_tfl_drugs, drug_senstive_precentage_luad_limma_drugs, drug_senstive_precentage_luad_deseq2_drugs)
drug_senstive_precentage_luad_methods$cancer <- rep("Lung adenocaracionoma", nrow(drug_senstive_precentage_luad_methods))



```


```{r}
#pancreatic adenicarcinoma
pancreas_deseq_tau <- read_csv("~/output/pancreas_cancer/deseq2_res/220602_SR_LINCS_PAAD_DESEQ2_RES_tau.csv")
pancreas_deseq_tau_fda_approved <- pancreas_deseq_tau[pancreas_deseq_tau$fda_approved == TRUE, ]

pancreas_limma_tau <- read_csv("~/output/pancreas_cancer/limma_res/220602_SR_LINCS_PAAD_limma_RES_tau.csv")
pancreas_limma_tau_fda_approved <- pancreas_limma_tau[pancreas_limma_tau$fda_approved == TRUE,]

pancreas_limma_tau <- read_csv("~/output/pancreas_cancer/limma_res/220602_SR_LINCS_PAAD_limma_RES_tau.csv")
pancreas_limma_tau_fda_approved <- pancreas_limma_tau[pancreas_limma_tau$fda_approved == TRUE,]

pancreas_tfl_tau <- read_csv("~/output/pancreas_cancer/TFL_res/220602_SR_LINCS_PAAD_TFL_RES_tau.csv")
pancreas_tfl_tau_fda_approved <- pancreas_tfl_tau[pancreas_tfl_tau$fda_approved == TRUE,]

##deseq2
drug_senstive_precentage_paad_deseq2_drugs<-drug_senstive_precentage_all_drugs[ drug_senstive_precentage_all_drugs$drug_list %in% pancreas_deseq_tau_fda_approved$pert,]
drug_senstive_precentage_paad_deseq2_drugs$method <- rep("DESeq2", nrow(drug_senstive_precentage_paad_deseq2_drugs))
##limma
drug_senstive_precentage_paad_limma_drugs<-drug_senstive_precentage_all_drugs[ drug_senstive_precentage_all_drugs$drug_list %in% pancreas_limma_tau_fda_approved$pert,]
drug_senstive_precentage_paad_limma_drugs$method <- rep("limma", nrow(drug_senstive_precentage_paad_limma_drugs))
##tfl
drug_senstive_precentage_paad_tfl_drugs<-drug_senstive_precentage_all_drugs[ drug_senstive_precentage_all_drugs$drug_list %in% pancreas_tfl_tau_fda_approved $pert,]
drug_senstive_precentage_paad_tfl_drugs$method <- rep("Transfer Learning", nrow(drug_senstive_precentage_paad_tfl_drugs))

drug_senstive_precentage_paad_methods<- rbind(drug_senstive_precentage_paad_tfl_drugs, drug_senstive_precentage_paad_limma_drugs, drug_senstive_precentage_paad_deseq2_drugs)
drug_senstive_precentage_paad_methods$cancer <- rep("Pancreatic adenicarcinoma", nrow(drug_senstive_precentage_paad_methods))

```

```{r}
drug_senstive_precentage_all_methods_cancers <- rbind(drug_senstive_precentage_paad_methods, drug_senstive_precentage_gbm_methods, drug_senstive_precentage_lihc_methods, drug_senstive_precentage_luad_methods)
```

```{r}
t <- ggplot(drug_senstive_precentage_all_methods_cancers,aes(x=method, y=drug_fraction ,fill=method))+
  #geom_point()+
  geom_violin() +
  geom_boxplot(width = 0.1, fill = "grey", color = "black") +
  facet_wrap(~cancer,nrow=1) + scale_fill_manual(values= c("#440154FF" ,"#21908CFF" ,"#FDE725FF")) + ylab("Fraction of Sensitive Cell Lines")
#t + geom_text(aes(label=labels_v2),vjust=- 15,  size= 10) +ylim(0, 90)
t
```

```{r}
primary_paad_res_v2 <- primary_paad_res[!is.na(primary_paad_res$log_fold_change),]


drug_list <- as.vector(unique(primary_paad_res_v2$Var2))
drug_median<- c()
for (i in 1:length(drug_list)){
  cells <-primary_paad_res_v2$log_fold_change[primary_paad_res_v2$Var2 %in% drug_list[i]]
  drug_median[i] <- median(cells)
}
drug_prism_median_all_drugs <- data.frame( drug_list, drug_median)
```


```{r}
#Glioblastoma
##deseq2
drug_senstive_precentage_gbm_deseq2_drugs<-drug_prism_median_all_drugs[ drug_prism_median_all_drugs$drug_list %in% lincs_deseq_gbm_res_GI1_fda_approved$pert,]
drug_senstive_precentage_gbm_deseq2_drugs$method <- rep("DESeq2", nrow(drug_senstive_precentage_gbm_deseq2_drugs))
##limma
drug_senstive_precentage_gbm_limma_drugs<-drug_prism_median_all_drugs[ drug_prism_median_all_drugs$drug_list %in% lincs_limma_gbm_res_GI1_fda_approved$pert,]
drug_senstive_precentage_gbm_limma_drugs$method <- rep("limma", nrow(drug_senstive_precentage_gbm_limma_drugs))
##tfl
drug_senstive_precentage_gbm_tfl_drugs<-drug_prism_median_all_drugs[ drug_prism_median_all_drugs$drug_list %in% lincs_deseq_gbm_res_GI1C_fda_approved$pert,]
drug_senstive_precentage_gbm_tfl_drugs$method <- rep("Transfer Learning", nrow(drug_senstive_precentage_gbm_tfl_drugs))

drug_senstive_precentage_gbm_methods<- rbind(drug_senstive_precentage_gbm_tfl_drugs, drug_senstive_precentage_gbm_limma_drugs, drug_senstive_precentage_gbm_deseq2_drugs)
drug_senstive_precentage_gbm_methods$cancer <- rep("Glioblastima", nrow(drug_senstive_precentage_gbm_methods))
```

```{r}
#Liver hepatocellular carcinoma

##deseq2
drug_senstive_precentage_lihc_deseq2_drugs<-drug_prism_median_all_drugs[ drug_prism_median_all_drugs$drug_list %in% liver_deseq_tau_fda_approved$pert,]
drug_senstive_precentage_lihc_deseq2_drugs$method <- rep("DESeq2", nrow(drug_senstive_precentage_lihc_deseq2_drugs))
##limma
drug_senstive_precentage_lihc_limma_drugs<-drug_prism_median_all_drugs[ drug_prism_median_all_drugs$drug_list %in% liver_limma_tau_fda_approved$pert,]
drug_senstive_precentage_lihc_limma_drugs$method <- rep("limma", nrow(drug_senstive_precentage_lihc_limma_drugs))
##tfl
drug_senstive_precentage_lihc_tfl_drugs<-drug_prism_median_all_drugs[ drug_prism_median_all_drugs$drug_list %in% liver_tfl_tau_fda_approved $pert,]
drug_senstive_precentage_lihc_tfl_drugs$method <- rep("Transfer Learning", nrow(drug_senstive_precentage_lihc_tfl_drugs))

drug_senstive_precentage_lihc_methods<- rbind(drug_senstive_precentage_lihc_tfl_drugs, drug_senstive_precentage_lihc_limma_drugs, drug_senstive_precentage_lihc_deseq2_drugs)
drug_senstive_precentage_lihc_methods$cancer <- rep("Liver hepatocellular carcinoma", nrow(drug_senstive_precentage_lihc_methods))
```

```{r}
#lung adenocaracionoma

##deseq2
drug_senstive_precentage_luad_deseq2_drugs<-drug_prism_median_all_drugs[ drug_prism_median_all_drugs$drug_list %in% lung_deseq_tau_fda_approved$pert,]
drug_senstive_precentage_luad_deseq2_drugs$method <- rep("DESeq2", nrow(drug_senstive_precentage_luad_deseq2_drugs))
##limma
drug_senstive_precentage_luad_limma_drugs<-drug_prism_median_all_drugs[ drug_prism_median_all_drugs$drug_list %in% lung_limma_tau_fda_approved$pert,]
drug_senstive_precentage_luad_limma_drugs$method <- rep("limma", nrow(drug_senstive_precentage_luad_limma_drugs))
##tfl
drug_senstive_precentage_luad_tfl_drugs<-drug_prism_median_all_drugs[ drug_prism_median_all_drugs$drug_list %in% lung_tfl_tau_fda_approved $pert,]
drug_senstive_precentage_luad_tfl_drugs$method <- rep("Transfer Learning", nrow(drug_senstive_precentage_luad_tfl_drugs))

drug_senstive_precentage_luad_methods<- rbind(drug_senstive_precentage_luad_tfl_drugs, drug_senstive_precentage_luad_limma_drugs, drug_senstive_precentage_luad_deseq2_drugs)
drug_senstive_precentage_luad_methods$cancer <- rep("Lung adenocaracionoma", nrow(drug_senstive_precentage_luad_methods))



```


```{r}
#pancreatic adenicarcinoma

##deseq2
drug_senstive_precentage_paad_deseq2_drugs<-drug_prism_median_all_drugs[ drug_prism_median_all_drugs$drug_list %in% pancreas_deseq_tau_fda_approved$pert,]
drug_senstive_precentage_paad_deseq2_drugs$method <- rep("DESeq2", nrow(drug_senstive_precentage_paad_deseq2_drugs))
##limma
drug_senstive_precentage_paad_limma_drugs<-drug_prism_median_all_drugs[ drug_prism_median_all_drugs$drug_list %in% pancreas_limma_tau_fda_approved$pert,]
drug_senstive_precentage_paad_limma_drugs$method <- rep("limma", nrow(drug_senstive_precentage_paad_limma_drugs))
##tfl
drug_senstive_precentage_paad_tfl_drugs<-drug_prism_median_all_drugs[ drug_prism_median_all_drugs$drug_list %in% pancreas_tfl_tau_fda_approved $pert,]
drug_senstive_precentage_paad_tfl_drugs$method <- rep("Transfer Learning", nrow(drug_senstive_precentage_paad_tfl_drugs))

drug_senstive_precentage_paad_methods<- rbind(drug_senstive_precentage_paad_tfl_drugs, drug_senstive_precentage_paad_limma_drugs, drug_senstive_precentage_paad_deseq2_drugs)
drug_senstive_precentage_paad_methods$cancer <- rep("Pancreatic adenicarcinoma", nrow(drug_senstive_precentage_paad_methods))

```

```{r}
drug_senstive_precentage_all_methods_cancers <- rbind(drug_senstive_precentage_paad_methods, drug_senstive_precentage_gbm_methods, drug_senstive_precentage_lihc_methods, drug_senstive_precentage_luad_methods)
```



```{r}
t <- ggplot(drug_senstive_precentage_all_methods_cancers,aes(x=method, y=drug_median ,fill=method))+
  #geom_point()+
  geom_violin() + geom_hline(yintercept=0.3, linetype="dashed", color = "red") +
  geom_boxplot(width = 0.1, fill = "grey", color = "black") +
  facet_wrap(~cancer,nrow=1) + scale_fill_manual(values= c("#440154FF" ,"#21908CFF" ,"#FDE725FF")) + ylab("Median log2fold change (PRISM)")
#t + geom_text(aes(label=labels_v2),vjust=- 15,  size= 10) +ylim(0, 90)
t
```












