---
title: "220608_gbm_CT_PRSIM_UPDATE"
author: "Jennifer Fisher"
date: "6/8/2022"
output:
  html_document:
    toc: true
    theme: united
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# START 
    Goal/Purpose of operations: 
    Create comparison plots for disease signatures, enriched pathways, and candidates. This was not done in earlier scripts. In addition, the clinical trial summary for each cancer is plotted. Also, the PRISM summary was plot for each cancer. 
    
    Finished psedocode on: 
    220608
    
    System which operations were done on: 
    my laptop(on cheaha)
    
    GitHub Repo:
    Transfer_Learning_R03
    
    Docker/Singularity: 
    rstudio_cancer_dr
    
    Directory of operations: 
    "/home/rstudio"
    
    Scripts being edited for operations:
    functions were added to the /home/rstudio/script/functions_cancer_signature_reversion_JLF.R
    
    Data being used:
    results from the singature reversion and PRISM
    
    Papers and tools: 
    NA

# STEPS
### Set working directory 
```{r}
library(recount3)
library(SummarizedExperiment)
source("/home/rstudio/script/functions_cancer_signature_reversion_JLF.R")
library(signatureSearch)
library(HDF5Array)
library(viridis)
library(tidyr)
library(gprofiler2)
library(ggplot2)
library(ggpubr)
library(VennDiagram)
library(ComplexHeatmap)
library(dplyr)
library(gplots)
library(circlize)
source("~/script/plier_util.R")
source("~/script/test_LV_differences.R")
library(dplyr)
library(readr)
```
### load in data

```{r}
limma_gbm_list <- readRDS("~/output/limma_gbm/SR_gene_list_gbm_limma.rds")
deseq_gbm_list <- readRDS("~/output/deseq2_gbm/SR_gene_list_gbm_deseq2.rds")
tfl_gbm_list <- readRDS("~/output/TF_L_GBM/22004_SR_gene_list_gbm_tfl.rds")
```

compare gene list across the different methods

```{r}
venn_dia_methods(limma_gbm_list$up, deseq_gbm_list$up, tfl_gbm_list$up, file_name='~/output/gbm_plots/SR_up_genes_venn_diagram.png' )
```

```{r}
venn_dia_methods(limma_gbm_list$down, deseq_gbm_list$down, tfl_gbm_list$down, file_name='~/output/gbm_plots/SR_down_genes_venn_diagram.png' )
```

```{r}
venn_dia_methods(unlist(limma_gbm_list), unlist(deseq_gbm_list), unlist(tfl_gbm_list), file_name='~/output/gbm_plots/SR_all_genes_venn_diagram.png' )
```

```{r}
limma_gbm_pathway_res <- method_up_down_gene_set_analysis(limma_gbm_list$up, limma_gbm_list$down, "~/output/gbm_plots/", "limma", "GBM_cancer_limma_input_genes_SR")
```

```{r}
deseq2_gbm_pathway_res<- method_up_down_gene_set_analysis(deseq_gbm_list$up, deseq_gbm_list$down, "~/output/gbm_plots/", "DESEq2", "gbm_cancer_deseq2_input_genes_SR")
```

```{r}
tfl_gbm_pathway_res<- method_up_down_gene_set_analysis(tfl_gbm_list$up, tfl_gbm_list$down, "~/output/gbm_plots/", "TFL", "gbm_cancer_tfl_input_genes_SR")
```


```{r}
limma<- limma_gbm_pathway_res$term_id[ limma_gbm_pathway_res$set == "Up"]
deseq2<- deseq2_gbm_pathway_res$term_id[ deseq2_gbm_pathway_res$set == "Up"]
tfl<-tfl_gbm_pathway_res$term_id[ tfl_gbm_pathway_res$set == "Up"]
venn_dia_methods(limma, deseq2, tfl, file_name='~/output/gbm_plots/SR_gbm_Up_pathway_venn_diagram.png' )
```

```{r}
limma<- limma_gbm_pathway_res$term_id[ limma_gbm_pathway_res$set == "Down"]
deseq2<- deseq2_gbm_pathway_res$term_id[ deseq2_gbm_pathway_res$set == "Down"]
tfl<-tfl_gbm_pathway_res$term_id[ tfl_gbm_pathway_res$set == "Down"]
venn_dia_methods(limma, deseq2, tfl, file_name='~/output/gbm_plots/SR_gbm_Down_pathway_venn_diagram.png' )
```

```{r}
limma<- limma_gbm_pathway_res$term_id
deseq2<- deseq2_gbm_pathway_res$term_id
tfl<-tfl_gbm_pathway_res$term_id
venn_dia_methods(limma, deseq2, tfl, file_name='~/output/gbm_plots/SR_gbm_all_pathway_venn_diagram.png' )
```


```{r}
lincs_limma_gbm_res_GI1_fda_approved<- read_csv( "~/output/limma_GBM/220808_SR_LINCS_GBM_top_RES_all.csv")
lincs_deseq_gbm_res_GI1_fda_approved<- read_csv( "~/output/deseq2_gbm/220928_SR_LINCS_GBM_DESEQ2_RES_all.csv")
lincs_tfl_gbm_res_GI1_fda_approved<- read_csv( "~/output/TF_L_GBM/220808_SR_LINCS_GBM_top_RES_all.csv")
```


```{r}
venn_dia_methods(lincs_limma_gbm_res_GI1_fda_approved$pert, lincs_deseq_gbm_res_GI1_fda_approved$pert, lincs_tfl_gbm_res_GI1_fda_approved$pert, file_name='~/output/gbm_plots/SR_drug_candidates_venn_diagram.png' )
```

Make summary plots of things
```{r}
clinical_trial_cancer_summary <- read_csv("~/output/220608_clinical_trial_cancer_summary.csv")
```

```{r}
clinical_trial_cancer_summary_v2 <- clinical_trial_cancer_summary %>% pivot_longer(c(CT, Not_Cl),names_to= "type" )
clinical_trial_cancer_summary_v2$type <- ifelse(clinical_trial_cancer_summary_v2$type == "CT", "Clinical Trial", "Not in Clinical Trial" )
```


```{r}
clinical_trial_cancer_summary$number <-  ifelse(clinical_trial_cancer_summary$significant== TRUE, (clinical_trial_cancer_summary$CT +clinical_trial_cancer_summary$Not_Cl), NA)
clinical_trial_cancer_summary$symbol <- ifelse(clinical_trial_cancer_summary$significant== TRUE, "*", "")
#clinical_trial_cancer_summary$cancer

labels <- clinical_trial_cancer_summary_v2$significant == TRUE & clinical_trial_cancer_summary_v2$type =="Clinical Trial"
labels_v2 <- ifelse(labels == "TRUE", "*", "")
clinical_trial_cancer_summary_v2$labels_v2<- labels_v2
```

```{r}
clinical_trial_summary_bar_plot(clinical_trial_cancer_summary_v2, "Glioblastoma", "~/output/220819_CT_GBM_barplot.png")
```


```{r}
clinical_trial_summary_bar_plot(clinical_trial_cancer_summary_v2, "Liver hepatocellular carcinoma", "~/output/220819_CT_liver_barplot.png")
```


```{r}
clinical_trial_summary_bar_plot(clinical_trial_cancer_summary_v2, "Lung adenocarcinoma", "~/output/220819_CT_lung_barplot.png")
```

```{r}
clinical_trial_summary_bar_plot(clinical_trial_cancer_summary_v2, "Pancreatic adenocarcinoma", "~/output/220819_CT_PAAD_barplot.png")
```

plotting the prism results 
gbm 
```{r}
PRISM_methods_plotting("~/output/TF_L_GBM/220928_prism_deseq2_candidates_gbm.csv", "~/output/TF_L_GBM/220808_prism_tfl_candidates_gbm.csv",  "~/output/limma_gbm/220808_prism_limma_candidates_gbm.csv", "~/output/220822_PRISM_GBM_violin.png")
```


liver 
```{r}
PRISM_methods_plotting("~/output/liver_cancer/deseq2_res/220929_prism_deseq2_candidates.csv", "~/output/liver_cancer/TFL_res/220808_prism_tfl_candidates.csv",  "~/output/liver_cancer/limma_res/220808_prism_limma_candidates.csv", "~/output/220822_PRISM_liver_violin.png")
```



pancreas
deseq2 prism was not saved in script signature reversion scripts
```{r}
primary_paad_res <-read.csv( "~/output/pancreas_cancer/220808_prism_paad_candidates.csv" )

lincs_deseq_paad_res_YAPC_top <- read.csv("~/output/pancreas_cancer/deseq2_res/220929_SR_LINCS_PAAD_DESEQ2_RES_tau.csv")
```

```{r}
lincs_deseq_paad_res_YAPC_top_fda<- lincs_deseq_paad_res_YAPC_top[lincs_deseq_paad_res_YAPC_top$fda_approved == TRUE,]
primary_paad_res_sub <-primary_paad_res[ primary_paad_res$Var2 %in% lincs_deseq_paad_res_YAPC_top_fda$pert,]
write.csv(primary_paad_res_sub , file= "~/output/pancreas_cancer/deseq2_res/220808_prism_deseq2_candidates.csv" )
```


```{r}
PRISM_methods_plotting("~/output/pancreas_cancer/deseq2_res/220808_prism_deseq2_candidates.csv", "~/output/pancreas_cancer/TFL_res/220808_prism_tfl_candidates.csv",  "~/output/pancreas_cancer/limma_res/220808_prism_limma_candidates.csv", "~/output/220822_PRISM_PAAD_violin.png")
```



lung 
deseq2 prism was not saved in script 
```{r}
lincs_deseq_luad_res_A549_top <- read.csv("~/output/lung_cancer/deseq2_res/220929_SR_LINCS_LUAD_DESEQ2_RES_tau.csv" )
primary_lung_res <-read.csv( file= "~/output/lung_cancer/220808_lung_prism_candidates.csv" )
lincs_deseq_luad_res_A549_top_fda<- lincs_deseq_luad_res_A549_top[lincs_deseq_luad_res_A549_top$fda_approved == TRUE,]
```

```{r}
primary_lung_res_sub <-primary_lung_res[ primary_lung_res$Var2 %in% lincs_deseq_luad_res_A549_top_fda$pert,]
write.csv(primary_lung_res_sub  , file= "~/output/lung_cancer/deseq2_res/220929_prism_deseq2_candidates.csv" )
```


```{r}
PRISM_methods_plotting("~/output/lung_cancer/deseq2_res/220929_prism_deseq2_candidates.csv", "~/output/lung_cancer/TFL_res/220808_prism_tfl_candidates.csv" ,  "~/output/lung_cancer/limma_res/220808_prism_limma_candidates.csv" , "~/output/220822_PRISM_lung_violin.png")
```

### Save Data
done within the script 

### Save Figures
done within the script 
    
# END
    Location of final scripts:
    script 
    
    Location of data produced:
    ~/output/
    
    Dates when operations were done:
    220822
    
## Versions
```{r}
sessionInfo()
```











