---
title: "220627_more_methods_comparsions"
author: "Jennifer Fisher"
date: "6/27/2022"
output:
  html_document:
    toc: true
    theme: united
---
# START 
    Goal/Purpose of operations: 
     Conduct comparison analysis on enriched Go biological process go terms for each cancer/method. Also create plots to summarize mechanism of action and drug targets for each method. 
    
    Finished psedocode on:
    220607
    
    System which operations were done on: 
    my laptop
    
    GitHub Repo:
    Transfer_Learning_R03
    
    Docker/Singularity: 
    rstudio_cancer_dr
    
    Directory of operations: 
    "/home/rstudio"
    
    Scripts being edited for operations:
    several functions are from /script/functions_cancer_signature_reversion_JLF.R
    
    Data being used: 
    Output results from signature reversion for each cancer/method
    ouputs for pathway results for disease signature for cancermethod
    
    Papers and tools:
    Go semenatic similarity analysis GOSemSim
    
# STEPS
### Set working directory 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(recount3)
library(SummarizedExperiment)
source("/home/rstudio/script/functions_cancer_signature_reversion_JLF.R")
library(signatureSearch)
library(HDF5Array)
library(viridis)
library(tidyr)
library(gprofiler2)
library(ggplot2)
library(ggpubr)
library(VennDiagram)
library(ComplexHeatmap)
library(dplyr)
library(gplots)
library(circlize)
source("~/script/plier_util.R")
source("~/script/test_LV_differences.R")
library(dplyr)
library(ggalluvial)
library(readr)
library(stringr)
library(RColorBrewer)
```

# load in data
gbm
```{r}
lincs_limma_gbm_res_GI1_fda_approved<- read_csv( "~/output/limma_gbm/220808_SR_LINCS_GBM_top_RES_all.csv")
lincs_deseq2_gbm_res_GI1_fda_approved <- read_csv( "~/output/deseq2_gbm/220928_SR_LINCS_GBM_DESEQ2_RES_all.csv")
lincs_tfl_gbm_res_GI1_fda_approved <- read_csv( "~/output/TF_L_GBM/220808_SR_LINCS_GBM_top_RES_all.csv")
```

```{r}
TFL_pathways <- read_delim("~/output/gbm_plots/TFL_pathways.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)

deseq2_pathways <- read_delim("~/output/gbm_plots/DESEq2_pathways.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)

limma_pathways <- read_delim("~/output/gbm_plots/limma_pathways.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)
```

liver
```{r}
lincs_deseq_gbm_res_HEPG2_fda_approved <- read_csv("~/output/liver_cancer/deseq2_res/220929_SR_LINCS_LIHC_DESEQ2_RES_tau.csv")
lincs_deseq_gbm_res_HEPG2_fda_approved <- lincs_deseq_gbm_res_HEPG2_fda_approved [lincs_deseq_gbm_res_HEPG2_fda_approved$fda_approved== TRUE,]

lincs_limma_gbm_res_HEPG2_fda_approved <- read_csv("~/output/liver_cancer/limma_res/220808_SR_LINCS_LIHC_limma_RES_tau.csv")

lincs_limma_gbm_res_HEPG2_fda_approved<- lincs_limma_gbm_res_HEPG2_fda_approved[ lincs_limma_gbm_res_HEPG2_fda_approved$fda_approved== TRUE,]
#wrong date on file
lincs_tfl_gbm_res_HEPG2_fda_approved <- read_csv("~/output/liver_cancer/TFL_res/220602_SR_LINCS_LIHC_TFL_RES_tau.csv")
lincs_tfl_gbm_res_HEPG2_fda_approved<- lincs_tfl_gbm_res_HEPG2_fda_approved[ lincs_tfl_gbm_res_HEPG2_fda_approved$fda_approved == TRUE, ]
```

```{r}
TFL_pathways_liver <- read_delim("~/output/liver_cancer/TFL_pathways.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)

deseq2_pathways_liver <-read_delim("~/output/liver_cancer/DESEq2_pathways.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)

limma_pathways_liver <- read_delim("~/output/liver_cancer/limma_pathways.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)
```


lung
```{r}
#comment.   
lincs_limma_gbm_res_A549_fda_approved<- read_csv("~/output/lung_cancer/limma_res/220808_SR_LINCS_LUAD_limma_RES_tau.csv")
lincs_limma_gbm_res_A549_fda_approved<- lincs_limma_gbm_res_A549_fda_approved[lincs_limma_gbm_res_A549_fda_approved$fda_approved == TRUE, ]
lincs_deseq_gbm_res_A549_fda_approved<- read_csv("~/output/lung_cancer/deseq2_res/220929_SR_LINCS_LUAD_DESEQ2_RES_tau.csv")
lincs_deseq_gbm_res_A549_fda_approved<- lincs_deseq_gbm_res_A549_fda_approved[lincs_deseq_gbm_res_A549_fda_approved$fda_approved == TRUE, ]
lincs_tfl_gbm_res_A549_fda_approved<- read_csv("~/output/lung_cancer/TFL_res/220808_SR_LINCS_LUAD_TFL_RES_tau.csv")
lincs_tfl_gbm_res_A549_fda_approved<- lincs_tfl_gbm_res_A549_fda_approved[lincs_tfl_gbm_res_A549_fda_approved$fda_approved==TRUE,]
```

```{r}
TFL_pathways_lung <- read_delim("~/output/lung_cancer/TFL_pathways.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)

deseq2_pathways_lung <-read_delim("~/output/lung_cancer/DESEq2_pathways.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)

limma_pathways_lung <- read_delim("~/output/lung_cancer/limma_pathways.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)
```

pancreatic
```{r}
lincs_deseq_gbm_res_YAPC_fda_approved <- read_csv("~/output/pancreas_cancer/deseq2_res/220929_SR_LINCS_PAAD_DESEQ2_RES_tau.csv")
lincs_deseq_gbm_res_YAPC_fda_approved<- lincs_deseq_gbm_res_YAPC_fda_approved[lincs_deseq_gbm_res_YAPC_fda_approved$fda_approved == TRUE,]

lincs_limma_gbm_res_YAPC_fda_approved <- read_csv("~/output/pancreas_cancer/limma_res/220808_SR_LINCS_PAAD_limma_RES_tau.csv")
lincs_limma_gbm_res_YAPC_fda_approved<- lincs_limma_gbm_res_YAPC_fda_approved[lincs_limma_gbm_res_YAPC_fda_approved$fda_approved ==TRUE, ]

lincs_tfl_gbm_res_YAPC_fda_approved <- read_csv("~/output/pancreas_cancer/TFL_res/220808_SR_LINCS_PAAD_TFL_RES_tau.csv")
lincs_tfl_gbm_res_YAPC_fda_approved<- lincs_tfl_gbm_res_YAPC_fda_approved[ lincs_tfl_gbm_res_YAPC_fda_approved$fda_approved ==TRUE,]
```

```{r}
TFL_pathways_PAAD <- read_delim("~/output/pancreas_cancer/TFL_pathways.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)

deseq2_pathways_PAAD <-read_delim("~/output/pancreas_cancer/DESEq2_pathways.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)

limma_pathways_PAAD <- read_delim("~/output/pancreas_cancer/limma_pathways.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)
```

download the compound info from LINCS
```{r}
lincs_commpound_info <- read.delim("~/data/LINCS_210914_LEVEL3/compoundinfo_beta.txt")
```


#compare drug targets

for gbm 
```{r}
limma_gbm_targets <- unique(unlist(str_split(lincs_limma_gbm_res_GI1_fda_approved$t_gn_sym, "; ")))

deseq_gbm_targets <- unique(unlist(str_split(lincs_deseq2_gbm_res_GI1_fda_approved$t_gn_sym, "; ")))
deseq_gbm_targets <- deseq_gbm_targets [complete.cases(deseq_gbm_targets )]
tfl_gbm_targets <- unique(unlist(str_split(lincs_tfl_gbm_res_GI1_fda_approved$t_gn_sym, "; ")))
```

```{r}
#tfl_gbm_targets has one NA from one of the drugs
tfl_gbm_targets<- tfl_gbm_targets[!is.na(tfl_gbm_targets)]
venn_dia_methods(limma_gbm_targets, deseq_gbm_targets, tfl_gbm_targets, file_name='~/output/gbm_plots/SR_drug_target_venn_diagram.png' )
```

for liver- note reusing gbm names
```{r}
limma_gbm_targets <- unique(unlist(str_split(lincs_limma_gbm_res_HEPG2_fda_approved$t_gn_sym, "; ")))
limma_gbm_targets <- limma_gbm_targets[complete.cases(limma_gbm_targets )]

deseq_gbm_targets <- unique(unlist(str_split(lincs_deseq_gbm_res_HEPG2_fda_approved$t_gn_sym, "; ")))
deseq_gbm_targets <- deseq_gbm_targets[complete.cases(deseq_gbm_targets)]

tfl_gbm_targets <- unique(unlist(str_split(lincs_tfl_gbm_res_HEPG2_fda_approved$t_gn_sym, "; ")))
tfl_gbm_targets <- tfl_gbm_targets[complete.cases(tfl_gbm_targets )]
```

```{r}
venn_dia_methods(limma_gbm_targets, deseq_gbm_targets, tfl_gbm_targets, file_name='~/output/liver_cancer/SR_drug_target_venn_diagram.png' )
```

for lung- note reusing gbm names
```{r}
limma_gbm_targets <- unique(unlist(str_split(lincs_limma_gbm_res_A549_fda_approved$t_gn_sym, "; ")))
limma_gbm_targets <- limma_gbm_targets[complete.cases(limma_gbm_targets )]

deseq_gbm_targets <- unique(unlist(str_split(lincs_deseq_gbm_res_A549_fda_approved$t_gn_sym, "; ")))
deseq_gbm_targets <- deseq_gbm_targets[complete.cases(deseq_gbm_targets)]

tfl_gbm_targets <- unique(unlist(str_split(lincs_tfl_gbm_res_A549_fda_approved$t_gn_sym, "; ")))
tfl_gbm_targets <- tfl_gbm_targets[complete.cases(tfl_gbm_targets )]
```

```{r}
venn_dia_methods(limma_gbm_targets, deseq_gbm_targets, tfl_gbm_targets, file_name='~/output/lung_cancer/SR_drug_target_venn_diagram.png' )
```

for pancreactic cancer - note reusing gbm names
```{r}
limma_gbm_targets <- unique(unlist(str_split(lincs_limma_gbm_res_YAPC_fda_approved$t_gn_sym, "; ")))
limma_gbm_targets <- limma_gbm_targets[complete.cases(limma_gbm_targets )]

deseq_gbm_targets <- unique(unlist(str_split(lincs_deseq_gbm_res_YAPC_fda_approved $t_gn_sym, "; ")))
deseq_gbm_targets <- deseq_gbm_targets[complete.cases(deseq_gbm_targets)]

tfl_gbm_targets <- unique(unlist(str_split(lincs_tfl_gbm_res_YAPC_fda_approved$t_gn_sym, "; ")))
tfl_gbm_targets <- tfl_gbm_targets[complete.cases(tfl_gbm_targets )]
```

```{r}
venn_dia_methods(limma_gbm_targets, deseq_gbm_targets, tfl_gbm_targets, file_name='~/output/pancreas_cancer/SR_drug_target_venn_diagram.png' )
```

Pathway enrichment venn diagrams

gbm
```{r eval=FALSE}
limma<- limma_pathways$term_id[ limma_pathways$set == "Up"]
deseq2<- deseq2_pathways$term_id[ deseq2_pathways$set == "Up"]
tfl<-TFL_pathways$term_id[ TFL_pathways$set == "Up"]
venn_dia_methods(limma, deseq2, tfl, file_name='~/output/gbm_plots/SR_gbm_Up_pathway_venn_diagram.png' )
```

```{r eval=FALSE}
limma<- limma_pathways$term_id[ limma_pathways$set == "Down"]
deseq2<- deseq2_pathways$term_id[ deseq2_pathways$set == "Down"]
tfl<-TFL_pathways$term_id[ TFL_pathways$set == "Down"]
venn_dia_methods(limma, deseq2, tfl, file_name='~/output/gbm_plots/SR_gbm_Down_pathway_venn_diagram.png' )
```

```{r eval=FALSE}
limma<- limma_pathways$term_id
deseq2<- deseq2_pathways$term_id
tfl<-TFL_pathways$term_id
venn_dia_methods(limma, deseq2, tfl, file_name='~/output/gbm_plots/SR_gbm_all_pathway_venn_diagram.png' )
```

liver 
limma_pathways_liver, deseq2_pathways_liver, TFL_pathways_liver,

```{r eval=FALSE}
limma<- limma_pathways_liver$term_id[ limma_pathways_liver$set == "Up"]
deseq2<- deseq2_pathways_liver$term_id[ deseq2_pathways_liver$set == "Up"]
tfl<-TFL_pathways_liver$term_id[ TFL_pathways_liver$set == "Up"]
venn_dia_methods(limma, deseq2, tfl, file_name='~/output/liver_cancer/SR_liver_Up_pathway_venn_diagram.png' )
```

```{r eval=FALSE}
limma<- limma_pathways_liver$term_id[ limma_pathways_liver$set == "Down"]
deseq2<- deseq2_pathways_liver$term_id[ deseq2_pathways_liver$set == "Down"]
tfl<-TFL_pathways_liver$term_id[ TFL_pathways_liver$set == "Down"]
venn_dia_methods(limma, deseq2, tfl, file_name='~/output/liver_cancer/SR_liver_Down_pathway_venn_diagram.png' )
```

```{r eval=FALSE}
limma<- limma_pathways_liver$term_id
deseq2<- deseq2_pathways_liver$term_id
tfl<-TFL_pathways_liver$term_id
venn_dia_methods(limma, deseq2, tfl, file_name='~/output/liver_cancer/SR_liver_all_pathway_venn_diagram.png' )
```

lung
```{r eval=FALSE}
limma<- limma_pathways_lung$term_id[ limma_pathways_lung$set == "Up"]
deseq2<- deseq2_pathways_lung$term_id[ deseq2_pathways_lung$set == "Up"]
tfl<-TFL_pathways_lung$term_id[ TFL_pathways_lung$set == "Up"]
venn_dia_methods(limma, deseq2, tfl, file_name='~/output/lung_cancer/SR_lung_Up_pathway_venn_diagram.png' )
```

```{r eval=FALSE}
limma<- limma_pathways_lung$term_id[ limma_pathways_lung$set == "Down"]
deseq2<- deseq2_pathways_lung$term_id[ deseq2_pathways_lung$set == "Down"]
tfl<-TFL_pathways_lung$term_id[ TFL_pathways_lung$set == "Down"]
venn_dia_methods(limma, deseq2, tfl, file_name='~/output/lung_cancer/SR_lung_Down_pathway_venn_diagram.png' )
```

```{r eval=FALSE}
limma<- limma_pathways_lung$term_id
deseq2<- deseq2_pathways_lung$term_id
tfl<-TFL_pathways_lung$term_id
venn_dia_methods(limma, deseq2, tfl, file_name='~/output/lung_cancer/SR_lung_all_pathway_venn_diagram.png' )
```

paad
```{r eval=FALSE}
limma<- limma_pathways_PAAD$term_id[ limma_pathways_PAAD$set == "Up"]
deseq2<- deseq2_pathways_PAAD$term_id[ deseq2_pathways_PAAD$set == "Up"]
tfl<-TFL_pathways_PAAD$term_id[ TFL_pathways_PAAD$set == "Up"]
venn_dia_methods(limma, deseq2, tfl, file_name='~/output/pancreas_cancer/SR_PAAD_Up_pathway_venn_diagram.png' )
```

```{r eval=FALSE}
limma<- limma_pathways_PAAD$term_id[ limma_pathways_PAAD$set == "Down"]
deseq2<- deseq2_pathways_PAAD$term_id[ deseq2_pathways_PAAD$set == "Down"]
tfl<-TFL_pathways_PAAD$term_id[ TFL_pathways_PAAD$set == "Down"]
venn_dia_methods(limma, deseq2, tfl, file_name='~/output/pancreas_cancer/SR_PAAD_Down_pathway_venn_diagram.png' )
```

```{r eval=FALSE}
limma<- limma_pathways_PAAD$term_id
deseq2<- deseq2_pathways_PAAD$term_id
tfl<-TFL_pathways_PAAD$term_id
venn_dia_methods(limma, deseq2, tfl, file_name='~/output/pancreas_cancer/SR_PAAD_all_pathway_venn_diagram.png' )
```

Gene Ontology Semantic Similarity analysis
```{r}
library(GOSemSim)
hsGO <- godata('org.Hs.eg.db', ont="BP")
```

```{r}
go_term_heatmap(limma_pathways, deseq2_pathways, TFL_pathways, "Up", file_name = "~/output/gbm_plots/go_term_parents_up_genes.csv")
```


```{r}
go_term_heatmap(limma_pathways, deseq2_pathways, TFL_pathways, "Down", file_name = "~/output/gbm_plots/go_term_parents_down_genes.csv")
```
```{r}
#go_term_tree_plot(limma_pathways, deseq2_pathways, TFL_pathways, list_type= "Down", num=80, k_num=5, colors= c( "#117733", "#661100",  "#0072B2", "#D55E00", "#AA4499"), shift=6)
```

# liver 

up 

```{r}
go_term_heatmap(limma_pathways_liver, deseq2_pathways_liver, TFL_pathways_liver, "Up", threshold =0.95, file_name = "~/output/liver_cancer/go_term_parents_up_genes.csv")
```

```{r}
#go_term_tree_plot(limma_pathways, deseq2_pathways1, TFL_pathways, "Up", num=80, k_num=5, colors= c( "#117733", "#661100",  "#0072B2", "#D55E00", "#AA4499"), shift=6)
```

down
```{r}
go_term_heatmap(limma_pathways_liver, deseq2_pathways_liver, TFL_pathways_liver, "Down", threshold =0.95, file_name = "~/output/liver_cancer/go_term_parents_down_genes.csv")
```

```{r}
#go_term_tree_plot(limma_pathways, deseq2_pathways1, TFL_pathways, "Down", num=80, k_num=5, colors= c( "#117733", "#661100",  "#0072B2", "#D55E00", "#AA4499"), shift=6)
```

# lung 

up 

```{r}
go_term_heatmap(limma_pathways_lung, deseq2_pathways_lung, TFL_pathways_lung, "Up", threshold =0.87, file_name = "~/output/lung_cancer/go_term_parents_up_genes.csv")
```

```{r}
#go_term_tree_plot(limma_pathways, deseq2_pathways1, TFL_pathways, "Up", num=80, k_num=5, colors= c( "#117733", "#661100",  "#0072B2", "#D55E00", "#AA4499"), shift=6)
```

down
```{r}
go_term_heatmap(limma_pathways_lung, deseq2_pathways_lung, TFL_pathways_lung, "Down", threshold =0.90, file_name = "~/output/lung_cancer/go_term_parents_down_genes.csv")
```

```{r}
#go_term_tree_plot(limma_pathways, deseq2_pathways1, TFL_pathways, "Down", num=80, k_num=5, colors= c( "#117733", "#661100",  "#0072B2", "#D55E00", "#AA4499"), shift=6)
```
# pancreatic 

up 
```{r}
go_term_heatmap(limma_pathways_PAAD, deseq2_pathways_PAAD, TFL_pathways_PAAD, "Up", threshold =0.70, file_name = "~/output/pancreas_cancer/go_term_parents_up_genes.csv")
```

```{r}
#go_term_tree_plot(limma_pathways, deseq2_pathways1, TFL_pathways, "Up", num=80, k_num=5, colors= c( "#117733", "#661100",  "#0072B2", "#D55E00", "#AA4499"), shift=6)
```

down
```{r}
go_term_heatmap(limma_pathways_PAAD, deseq2_pathways_PAAD, TFL_pathways_PAAD, "Down", threshold =0.95, file_name = "~/output/pancreas_cancer/go_term_parents_down_genes.csv")
```

```{r}
#go_term_tree_plot(limma_pathways, deseq2_pathways1, TFL_pathways, "Down", num=80, k_num=5, colors= c( "#117733", "#661100",  "#0072B2", "#D55E00", "#AA4499"), shift=6)
```


Alluvial and bar plots for each method/cancer combination for Mechanism of Action and Drug Targets

```{r}
drug_moa_target_plotting(lincs_tfl_gbm_res_GI1_fda_approved ,lincs_commpound_info=lincs_commpound_info, "TLF", "GBM", "~/output/candidate_moa_target_plots/220811" )

drug_moa_target_plotting(lincs_limma_gbm_res_GI1_fda_approved ,lincs_commpound_info=lincs_commpound_info, "limma", "GBM", "~/output/candidate_moa_target_plots/220811" )

drug_moa_target_plotting(lincs_deseq2_gbm_res_GI1_fda_approved ,lincs_commpound_info=lincs_commpound_info, "deseq2", "GBM", "~/output/candidate_moa_target_plots/220811" )
```


```{r}
drug_moa_target_plotting(lincs_tfl_gbm_res_YAPC_fda_approved ,lincs_commpound_info=lincs_commpound_info, "TLF", "pan", "~/output/candidate_moa_target_plots/2208011" )

drug_moa_target_plotting(lincs_limma_gbm_res_YAPC_fda_approved ,lincs_commpound_info=lincs_commpound_info, "limma", "pan", "~/output/candidate_moa_target_plots/2208011" )

drug_moa_target_plotting(lincs_deseq_gbm_res_YAPC_fda_approved ,lincs_commpound_info=lincs_commpound_info, "deseq2", "pan", "~/output/candidate_moa_target_plots/2208011" )
```


```{r}
drug_moa_target_plotting(lincs_tfl_gbm_res_A549_fda_approved ,lincs_commpound_info=lincs_commpound_info, "TLF", "lung", "~/output/candidate_moa_target_plots/220808" )

drug_moa_target_plotting(lincs_limma_gbm_res_A549_fda_approved ,lincs_commpound_info=lincs_commpound_info, "limma", "lung", "~/output/candidate_moa_target_plots/220808" )

drug_moa_target_plotting(lincs_deseq_gbm_res_A549_fda_approved ,lincs_commpound_info=lincs_commpound_info, "deseq2", "lung", "~/output/candidate_moa_target_plots/220808" )
```


```{r}
drug_moa_target_plotting(lincs_tfl_gbm_res_HEPG2_fda_approved ,lincs_commpound_info=lincs_commpound_info, "TLF", "liver", "~/output/candidate_moa_target_plots/220808" )

drug_moa_target_plotting(lincs_limma_gbm_res_HEPG2_fda_approved ,lincs_commpound_info=lincs_commpound_info, "limma", "liver", "~/output/candidate_moa_target_plots/220808" )

drug_moa_target_plotting(lincs_deseq_gbm_res_HEPG2_fda_approved,lincs_commpound_info=lincs_commpound_info, "deseq2", "liver", "~/output/candidate_moa_target_plots/220808" )
```




### Save Data
NA

### Save Figures
done
    
# END
    Location of final scripts:
    script 
    
    Location of data produced:
    ~/output
    
    Dates when operations were done:
    220816
    
## Versions
```{r}
sessionInfo()
```



