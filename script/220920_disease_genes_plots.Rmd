---
title: "220920_disease_genes_plots"
author: "Jennifer Fisher"
date: "9/20/2022"
output:
  html_document:
    toc: true
    theme: united
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# START 
    Goal/Purpose of operations: 
    The DepMap/PRISMâ€™s primary and secondary pooled drug screens were used to help evaluate if a candidate could be a suitable candidate (if that drug was tested). The primary screen calculated the median of log fold change median fluorescence intensity between replicates of a cell line treated with a drug. The PRISM study considered a cell line as sensitive to a treatment if the median-collapsed fold-change is less than 0.3. The secondary screen calculated the Area under the curve of the dose-response curve from a 4-parameter logistic curve. While the PRISM study did not provide a cut-off for sensitivity, lower AUC values were considered more sensitive, and we compared the AUC values of a drug candidate to the AUC of temozolomide, the standard treatment of GBM (~0.90).
    
    Finished psedocode on: 
    220920
    
    System which operations were done on:
    my laptop
    
    GitHub Repo:
    Transfer_Learning_R03
    
    Docker:
    rstudio_cancer_dr
    
    Directory of operations:
    /home - docker
    
    Scripts being edited for operations: 
    NA
    
    Data being used: 
    DESeq2 and limma results 
    
    Papers and tools:
    NA

# STEPS
### Set working directory 

```{r}
library(ggplot2)
library(cowplot)
library(ggpubr)
library(recount3)
library(SummarizedExperiment)
library(viridis)
source("/home/rstudio/script/functions_cancer_signature_reversion_JLF.R")
library(tidyverse)
```

### load in data

```{r}
#deseq2 results 
deseq_results <- read.csv("~/output/deseq2_gbm/220927_deseq2_gbm_normal_gtx_res.csv", sep=",")
#add gene symbol to results
human_projects<- available_projects()
#get a random project data
test<- create_rse(human_projects[(human_projects$project == "SRP118922"),])
gene_info <- test@rowRanges
deseq_results$Symbol<- gene_info$gene_name


#limma results
#GBM_GTEX_gene_limma_res <- readRDS("~/output/limma_gbm/220421_GBM_GTEX_gene_limma_res.rds")
#GBM_GTEX_gene_limma <- GBM_GTEX_gene_limma_res$limma
#rds not in github using tsv instead

GBM_GTEX_gene_limma <- read_tsv("~/output/limma_gbm/220421_limma_TCGA_GTEX_T_vs_NT_limma_results.tsv")

#disease signatures from all the methods 
gbm_tfl_input <- readRDS("~/output/TF_L_GBM/22004_SR_gene_list_gbm_tfl.rds")
gbm_deseq2_input<- readRDS("~/output/deseq2_gbm/SR_gene_list_gbm_deseq2.rds")
gbm_limma_input<- readRDS("~/output/limma_gbm/SR_gene_list_gbm_limma.rds")
```

#liver
```{r}
#deseq2
LIHC_deseq_results <- read.csv("~/output/liver_cancer/deseq2_res/220929_deseq2_lihc_normal_gtx_res.csv", sep=",")
LIHC_deseq_results$Symbol<- gene_info$gene_name
#limma
#LIHC_GTEX_gene_limma_res <- readRDS("~/output/liver_cancer/limma_res/220808_LIHC_GTEX_gene_limma_res.rds")
#LIHC_GTEX_gene_limma <- LIHC_GTEX_gene_limma_res$limma
LIHC_GTEX_gene_limma<- read_tsv("~/output/liver_cancer/limma_res/220808_limma_TCGA_GTEX_T_vs_NT_liver_cancer_limma_results.tsv")
#disease singatures 
liver_tfl_input <- readRDS("~/output/liver_cancer/TFL_res/SR_gene_list_liver_tfl.rds")
liver_deseq2_input <- readRDS("~/output/liver_cancer/deseq2_res/SR_gene_list_liver_deseq2.rds")
liver_limma_input <- readRDS("~/output/liver_cancer/limma_res/SR_gene_list_liver_limma.rds")
```

#lung
```{r}
#deseq2
lung_deseq_results <- read.csv("~/output/lung_cancer/deseq2_res/220929_deseq2_luad_normal_gtx_res.csv", sep=",")
lung_deseq_results$Symbol<- gene_info$gene_name
#limma
#lung_GTEX_gene_limma_res <- readRDS("~/output/lung_cancer/limma_res/220808_LUAD_GTEX_gene_limma_res.rds")
#lung_GTEX_gene_limma <- lung_GTEX_gene_limma_res$limma
lung_GTEX_gene_limma<- read_tsv("~/output/lung_cancer/limma_res/220808_limma_TCGA_GTEX_T_vs_NT_lung_cancer_limma_results.tsv")
#disease singatures 
lung_deseq2_input <- readRDS("~/output/lung_cancer/deseq2_res/SR_gene_list_luad_deseq2.rds")
lung_tfl_input<- readRDS("~/output/lung_cancer/deseq2_res/SR_gene_list_lung_tfl.rds")
lung_limma_input<- readRDS("~/output/lung_cancer/deseq2_res/SR_gene_list_lung_limma.rds")
```

#pancreatic cancer 
```{r}
#deseq2
paad_deseq_results <-read.csv("~/output/pancreas_cancer/deseq2_res/Deseq2_paad_normal_gtx_res.csv", sep= ",")
paad_deseq_results$Symbol<- gene_info$gene_name
#limma
#paad_GTEX_gene_limma_res <- readRDS("~/output/pancreas_cancer/limma_res/220808_PAAD_GTEX_gene_limma_res.rds")
#paad_GTEX_gene_limma <- paad_GTEX_gene_limma_res$limma
paad_GTEX_gene_limma<- read_tsv("~/output/pancreas_cancer/limma_res/220808_limma_TCGA_GTEX_T_vs_NT_pancreas_cancer_limma_results.tsv")
#disease singatures 
paad_tfl_input <- readRDS("~/output/pancreas_cancer/TFL_res/SR_gene_list_paad_tfl.rds")
paad_limma_input <- readRDS("~/output/pancreas_cancer/limma_res/SR_gene_list_paad_limma.rds")
paad_deseq2_input <- readRDS("~/output/pancreas_cancer/deseq2_res/SR_gene_list_paad_deseq2.rds")
```
need to create the gene venn diagram for liver cancer 

compare gene list across the different methods

```{r eval=FALSE}
venn_dia_methods(liver_limma_input$up, liver_deseq2_input$up, liver_tfl_input$up, file_name='~/output/liver_cancer/SR_up_genes_venn_diagramm.png' )
```

```{r eval=FALSE}
venn_dia_methods(liver_limma_input$down, liver_deseq2_input$down, liver_tfl_input$down, file_name='~/output/liver_cancer/SR_down_genes_venn_diagramm.png' )
```

```{r eval=FALSE}
venn_dia_methods(unlist(liver_limma_input), unlist(liver_deseq2_input), unlist(liver_tfl_input), file_name='~/output/liver_cancer/SR_all_genes_venn_diagramm.png' )
```

GBM
```{r}
#gbm_deseq2
volcano_plots(deseq_results, "DESeq2", gbm_deseq2_input, gbm_tfl_input)
```



```{r}
volcano_plots(GBM_GTEX_gene_limma, "limma", gbm_limma_input, gbm_tfl_input)
```

liver 
```{r}
#gbm_deseq2
volcano_plots(LIHC_deseq_results, "DESeq2", liver_deseq2_input, liver_tfl_input)
```

```{r}
volcano_plots(LIHC_GTEX_gene_limma, "limma", liver_limma_input, liver_tfl_input)
```


```{r}
#gbm_deseq2
volcano_plots(lung_deseq_results, "DESeq2", lung_deseq2_input, lung_tfl_input)
```

```{r}
volcano_plots(lung_GTEX_gene_limma, "limma", lung_limma_input, lung_tfl_input)
```

```{r}
#gbm_deseq2
volcano_plots(paad_deseq_results, "DESeq2", paad_deseq2_input, paad_tfl_input)
```

```{r}
volcano_plots(paad_GTEX_gene_limma, "limma", paad_limma_input, paad_tfl_input)
```

GBM
```{r}
compare_deseq2_limma(deseq_results, GBM_GTEX_gene_limma)
```

liver
```{r}
compare_deseq2_limma(LIHC_deseq_results, LIHC_GTEX_gene_limma,  x_p1=2, y_p1=20, x_p2=100, y_p2=400)
```

```{r}
compare_deseq2_limma(lung_deseq_results,lung_GTEX_gene_limma,  x_p1=-5, y_p1=20, x_p2=100, y_p2=400)
```


```{r}
compare_deseq2_limma(paad_deseq_results,paad_GTEX_gene_limma,  x_p1=-5, y_p1=20, x_p2=25, y_p2=50)
```

```{r}
cancers<- factor(c("glioblastoma", "liver hepatocellular \ncarcinoma",  "lung \nadenocarcinoma", " pancreatic \nadenocarcinoma"), levels = c("glioblastoma", "liver hepatocellular \ncarcinoma",  "lung \nadenocarcinoma", " pancreatic \nadenocarcinoma"))
deseq2_limma_sum<- data.frame(cancers= cancers, spearman =c(0.94, 0.69, 0.81, 0.81, 0.72, 0.55, 0.61, 0.55), Metric = c(rep("logFC", 4), rep("Adj. p-value", 4)))
```

```{r}
ggplot(deseq2_limma_sum, aes(x=Metric, y= spearman, fill=Metric)) + geom_bar(stat="identity", position=position_dodge(), color = "black")+ ylab("Spearman Coefficient") +
  facet_wrap(~ cancers, ncol = 4)+ xlab("Metric") + scale_fill_viridis_d(option= "E") +theme(axis.text.x=element_blank(),axis.ticks.x=element_blank()) +theme(text = element_text(size = 35,  face="bold"))
```

```{r}
library(readr)
deseq_results_all <- read_csv("~/output/deseq2_gbm/220928_SR_LINCS_GBM_DESEQ2_RES.csv")
#correct file based on limma gbm script
limma_results_all <- read_csv("~/output/limma_gbm/220421_SR_LINCS_GBM_LIMMA_RES.csv")
tfl_results_all  <- read_csv("~/output/TF_L_GBM/220808_SR_LINCS_GBM_TRL_RES.csv")
```

```{r}
lincs_method_comparsion(deseq_results_all,limma_results_all , tfl_results_all, cell_line= "GI1")
```

#liver 
```{r}
deseq_results_all_liver <- read_csv("~/output/liver_cancer/deseq2_res/220929_SR_LINCS_LIHC_DESEQ2_RES.csv")
limma_results_all_liver<- read_csv("~/output/liver_cancer/220808_SR_LINCS_LIVER_LIMMA_RES.csv")
tfl_results_all_liver<- read_csv("~/output/liver_cancer/TFL_res/220808_SR_LINCS_LIVER_TFL_RES.csv")
```


```{r}
lincs_method_comparsion(deseq_results_all_liver,limma_results_all_liver , tfl_results_all_liver, cell_line= "HEPG2")
```

#lung 
```{r}
deseq_results_all_lung <- read_csv("~/output/lung_cancer/deseq2_res/220929_SR_LINCS_LUAD_DESEQ2_RES.csv")
limma_results_all_lung <- read_csv("~/output/lung_cancer/limma_res/220808_SR_LINCS_LUNG_LIMMA_RES.csv")
tfl_results_all_lung<- read_csv("~/output/lung_cancer/220601_SR_LINCS_LUNG_TFL_RES.csv")
```

```{r}
lincs_method_comparsion(deseq_results_all_lung ,limma_results_all_lung , tfl_results_all_lung, cell_line= "A529")
```

# paad 
```{r}
deseq_results_all_PAAD <- read_csv("~/output/pancreas_cancer/deseq2_res/220929_SR_LINCS_PAAD_DESEQ2_RES.csv")
limma_results_all_PAAD <- read_csv( "~/output/pancreas_cancer/limma_res/220808_SR_LINCS_PANCREAS_LIMMA_RES.csv")
tfl_results_all_PAAD<- read_csv( "~/output/pancreas_cancer/220808_SR_LINCS_PANCREAS_TFL_RES.csv")
```

```{r}
lincs_method_comparsion(deseq_results_all_PAAD ,limma_results_all_PAAD , tfl_results_all_PAAD, cell_line= "YAPC")
```


#plot all of them together


```{r}
NCS_sp<- c(0.59, 0.3, 0.37, 0.18, 0.036, 0.4, 0.029, -0.026, 0.27, 0.34, 0.28, 0.36)
FDR_sp <- c(0.38, 0.16, 0.13, -0.012, -0.048, 0.18, 0.053, -0.058, -0.036, 0.12, 0.16, 0.23)
NCS_test<- c(T, T,T, T, F,T,F,F,T,T,T,T)
FDR_test<- c(T,T,T,F,F,T,F,F,F,T,T,T)
#c("glioblastoma", "liver hepatocellular carcinoma",  "lung adenocarcinoma", " pancreatic adenocarcinoma")
cancer<- c(rep("glioblastoma", 3), rep("liver hepatocellular \ncarcinoma", 3), rep("lung \nadenocarcinoma", 3), rep("pancreatic \nadenocarcinoma", 3))
comp <- rep( c("DESeq2 vs. \nlimma", "DESeq2 vs \nTransfer Learning", "limma vs \nTransfer Learning"), 8)

lincs_result_compare <- data.frame(NCS_sp, FDR_sp, NCS_test, FDR_test, cancer, comp)
```

```{r}
lincs_result_compare_longer<- pivot_longer(lincs_result_compare, cols = c(NCS_sp, FDR_sp), values_to = "spearman", names_to = "metric_1")
```

```{r}
lincs_result_compare_longer2<- pivot_longer(lincs_result_compare_longer, cols = c(NCS_test, FDR_test), values_to = "Significant", names_to = "metric_2")
```

```{r}
lincs_result_compare_longer2$metric <- strtrim(lincs_result_compare_longer2$metric_1, 3)
lincs_result_compare_longer2$symbol <- ifelse(lincs_result_compare_longer2$Significant == TRUE, "*", "")
```


```{r}
ggplot(lincs_result_compare_longer2, aes(x=metric, y= spearman, fill=metric)) + geom_bar(stat="identity", position=position_dodge(), color = "black")+ ylab("Spearman Coefficient") + xlab("Metric")  +theme(axis.text.x=element_blank(),axis.ticks.x=element_blank()) +facet_grid( comp ~ cancer) + scale_fill_viridis_d(option= "E")+theme(text = element_text(size = 20,  face="bold"))
```



# END
    Location of final scripts:
    scripts
    
    Location of data produced:
    output
    
    Dates when operations were done:
    220920
    
## Versions
```{r}
sessionInfo()
```



